var zs=Object.defineProperty;var kr=P=>{throw TypeError(P)};var Ws=(P,s,d)=>s in P?zs(P,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):P[s]=d;var oe=(P,s,d)=>Ws(P,typeof s!="symbol"?s+"":s,d),qs=(P,s,d)=>s.has(P)||kr("Cannot "+d);var Cr=(P,s,d)=>s.has(P)?kr("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(P):s.set(P,d);var St=(P,s,d)=>(qs(P,s,"access private method"),d);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))h(f);new MutationObserver(f=>{for(const v of f)if(v.type==="childList")for(const y of v.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&h(y)}).observe(document,{childList:!0,subtree:!0});function d(f){const v={};return f.integrity&&(v.integrity=f.integrity),f.referrerPolicy&&(v.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?v.credentials="include":f.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function h(f){if(f.ep)return;f.ep=!0;const v=d(f);fetch(f.href,v)}})();const Gs="https://files.rcsb.org/ligands/view",Ys="https://models.rcsb.org/v1",Js="https://raw.githubusercontent.com/cch1999/cch1999.github.io/refs/heads/new_website/assets/files/fragment_library_ccd.tsv",Xs="https://www.ebi.ac.uk/pdbe/graph-api/compound/similarity",Ks="https://www.ebi.ac.uk/pdbe/graph-api/compound/in_pdb",Zs="https://data.rcsb.org/rest/v1/core/entry",Qs="https://www.ebi.ac.uk/pdbe/graph-api/pdb/summary",ea="https://files.rcsb.org/download",ta="https://www.ebi.ac.uk/pdbe/api/pdb/entry/ligand_monomers",ra="https://data.rcsb.org/rest/v1/core/entry_groups",Sr="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound",na="https://pubchem.ncbi.nlm.nih.gov/compound",Dt="https://www.ebi.ac.uk/pdbe/static/files/pdbechem_v2",Ke="https://www.rcsb.org/structure",Ze="https://www.ebi.ac.uk/pdbe/entry/pdb",ia="https://cdn.rcsb.org/images/structures",oa=["HOH","ZN","MG","CA","NA","K","CL"],sa=100,aa=["HEM","NAD","FAD","COA","ATP","ADP","355","MPV","YQD","J9N","VIA"],la=["SO4","PO4","CIT","EDO","GOL","1PE","ACE","ACT","BME","DMS","FMT","IMD","MES","PEG","PGE","TRS"],Xe=new Map;var Ie,Mt;class K{static async fetchText(s){return St(this,Ie,Mt).call(this,s,d=>d.text())}static async fetchJson(s){return St(this,Ie,Mt).call(this,s,d=>d.json())}static getCcdSdf(s){return this.fetchText(`${Gs}/${s.toUpperCase()}_ideal.sdf`)}static getInstanceSdf(s,d,h){return this.fetchText(`${Ys}/${s.toUpperCase()}/ligand?auth_seq_id=${d}&label_asym_id=${h}&encoding=sdf`)}static getFragmentLibraryTsv(){return this.fetchText(Js)}static getSimilarCcds(s){return this.fetchJson(`${Xs}/${s}`)}static getPdbEntriesForCcd(s){return this.fetchJson(`${Ks}/${s}`)}static getRcsbEntry(s){return this.fetchJson(`${Zs}/${s.toLowerCase()}`)}static getPdbSummary(s){return this.fetchJson(`${Qs}/${s}`)}static getPdbFile(s){return this.fetchText(`${ea}/${s}.pdb`)}static getLigandMonomers(s){return this.fetchJson(`${ta}/${s}`)}static async getPubChemSynonyms(s){var f,v,y;const d=`${Sr}/name/${encodeURIComponent(s)}/synonyms/JSON`,h=await this.fetchJson(d);return((y=(v=(f=h==null?void 0:h.InformationList)==null?void 0:f.Information)==null?void 0:v[0])==null?void 0:y.Synonym)??[]}static async getPubChemProperties(s){var f,v;const d=`${Sr}/name/${encodeURIComponent(s)}/property/MolecularFormula,MolecularWeight,IUPACName,CanonicalSMILES/JSON`,h=await this.fetchJson(d);return((v=(f=h==null?void 0:h.PropertyTable)==null?void 0:f.Properties)==null?void 0:v[0])??null}static async getPubChemMetadata(s){const[d,h]=await Promise.all([this.getPubChemSynonyms(s).catch(()=>[]),this.getPubChemProperties(s).catch(()=>null)]),f=h==null?void 0:h.CID;return{synonyms:d,properties:h,link:f?`${na}/${f}`:null}}static getProteinGroup(s){return this.fetchJson(`${ra}/${s}`)}static clearCache(){Xe.clear()}}Ie=new WeakSet,Mt=async function(s,d){if(Xe.has(s))return Xe.get(s);const h=await fetch(s);if(!h.ok){const v=new Error(`HTTP error! status: ${h.status}`);throw v.status=h.status,v.url=s,v}const f=await d(h);return Xe.set(s,f),f},Cr(K,Ie);class ca{constructor(s,d){this.repository=s,this.cardUI=d}async loadAllMolecules(){for(const s of this.repository.getAllMolecules())s.status==="pending"&&await this.loadMolecule(s)}async loadMolecule(s){const{code:d,pdbId:h,authSeqId:f,labelAsymId:v}=typeof s=="string"?{code:s}:s;try{this.repository.updateMoleculeStatus(d,"loading");const y=await this.findMoleculeInLocalTsv(d);if(y){this.repository.updateMoleculeStatus(d,"loaded"),this.cardUI.createMoleculeCardFromSmiles(y,d);return}let p;if(h&&f&&v?p=await K.getInstanceSdf(h,f,v):p=await K.getCcdSdf(d),!p||p.trim()===""||p.toLowerCase().includes("<html"))throw new Error("Received empty or invalid SDF data.");this.repository.updateMoleculeStatus(d,"loaded");const w=this.repository.getMolecule(d);w&&(w.sdf=p),this.cardUI.createMoleculeCard(p,d,"sdf")}catch(y){console.error(`Could not fetch or process data for ${d}:`,y),this.repository.updateMoleculeStatus(d,"error"),this.cardUI.createNotFoundCard(d,`Failed to load: ${y.message}`)}}async findMoleculeInLocalTsv(s){try{const h=(await K.getFragmentLibraryTsv()).split(`
`);for(const f of h){const v=f.split("	");if(v.length>8&&v[8]===s)return v[3]}return null}catch(d){return console.error("Error searching fragment library TSV:",d),null}}}class da{constructor(s=[]){this.molecules=s.map(d=>({...d,id:this.generateId(d)}))}generateId(s){if(typeof s=="string")return s;const{code:d,pdbId:h,authSeqId:f,labelAsymId:v}=s;return h&&f&&v?`${h}_${v}_${f}_${d}`:d}addMolecule(s){const d=this.generateId(s);if(this.molecules.find(f=>f.id===d))return!1;const h={code:typeof s=="string"?s:s.code,status:"pending",id:d};return s&&typeof s=="object"&&Object.assign(h,s),this.molecules.push(h),!0}removeMolecule(s){const d=this.molecules.findIndex(h=>h.id===s||h.code===s);return d===-1?!1:(this.molecules.splice(d,1),!0)}deleteAllMolecules(){this.molecules=[]}getMolecule(s){return this.molecules.find(d=>d.id===s||d.code===s)}updateMoleculeStatus(s,d){const h=this.getMolecule(s);h&&(h.status=d)}getAllMolecules(){return[...this.molecules]}clearAll(){this.molecules=[]}removeHydrogensFromSdf(s){const d=s.split(/\r?\n/);if(d.length<4)return s;const h=d[3],f=parseInt(h.slice(0,3)),v=parseInt(h.slice(3,6)),y=d.slice(4,4+f),p=d.slice(4+f,4+f+v),w=d.slice(4+f+v),E=[],b=[];y.forEach((R,H)=>{R.slice(31,34).trim()!=="H"&&(E.push(H+1),b.push(R))});const L=new Map;E.forEach((R,H)=>{L.set(R,H+1)});const T=[];p.forEach(R=>{const H=parseInt(R.slice(0,3)),z=parseInt(R.slice(3,6));if(L.has(H)&&L.has(z)){const Q=String(L.get(H)).padStart(3,"0"),X=String(L.get(z)).padStart(3,"0");T.push(Q+X+R.slice(6))}});const j=String(b.length).padStart(3,"0")+String(T.length).padStart(3,"0")+h.slice(6);return[...d.slice(0,3),j,...b,...T,...w].join(`
`)}exportToSdf(s={}){const{removeHydrogens:d=!1}=s;return this.molecules.filter(h=>h.sdf).map(h=>{let f=d?this.removeHydrogensFromSdf(h.sdf):h.sdf;return f=f.trimEnd(),f.endsWith("$$$$")||(f+=`
$$$$`),f}).join(`
`)}}class ua{constructor(s,d,h){this.addMolecule=s,this.showMoleculeDetails=d,this.ligandModal=h}populateBoundLigands(s){const d=document.getElementById("bound-ligands-section"),h=document.getElementById("bound-ligands-table"),f=document.getElementById("bound-ligands-tbody"),v=document.getElementById("no-bound-ligands-message"),y=document.getElementById("add-all-bound-btn");f.innerHTML="",K.getLigandMonomers(s).then(p=>{const w=p[s.toLowerCase()];if(w&&w.length>0){const E=w.filter(T=>!oa.includes(T.chem_comp_id)),b=E.length>0?E:w;d.style.display="block",h.style.display="table",v.style.display="none",b.forEach(T=>{const j=this.createBoundLigandRow(T,s);f.appendChild(j)});const L=b;L.length>0?(y.style.display="inline-block",y.textContent=`Add All (${L.length})`,y.onclick=()=>this.addAllLigands(L,"bound",s)):y.style.display="none"}else d.style.display="block",h.style.display="none",v.style.display="block",y.style.display="none"}).catch(p=>{console.error("Error fetching bound ligands:",p),d.style.display="block",h.style.display="none",v.style.display="block",v.textContent="Could not load bound ligand data.",y.style.display="none";const w=p.status&&p.url?`Failed to load bound ligands (status ${p.status}) from ${p.url}`:"Failed to load bound ligand data.";typeof showNotification=="function"&&showNotification(w,"error")})}createBoundLigandRow(s,d){const h=document.createElement("tr"),f=document.createElement("td");f.className="structure-2d";const v=document.createElement("div");v.className="loading",v.textContent="Loading...",f.appendChild(v),this.ligandModal&&this.ligandModal.load2DStructure(s.chem_comp_id,v);const y=document.createElement("td"),p=document.createElement("span");p.className="ccd-code",p.textContent=s.chem_comp_id,p.title=`Click to add ${s.chem_comp_id} to database`,p.addEventListener("click",()=>{document.getElementById("close-pdb-details-modal").click(),this.showMoleculeDetails&&this.showMoleculeDetails(s.chem_comp_id)}),y.appendChild(p);const w=document.createElement("td");w.textContent=s.chain_id;const E=document.createElement("td");E.textContent=s.author_residue_number;const b=document.createElement("td");b.textContent=s.entity_id;const L=document.createElement("td");L.className="ligand-name",L.textContent=s.chem_comp_name,L.title=s.chem_comp_name;const T=document.createElement("td"),j=document.createElement("button");return j.className="add-ligand-btn",j.innerHTML="&#43;",j.title=`Add ${s.chem_comp_id} to database`,j.addEventListener("click",()=>{this.addMolecule({code:s.chem_comp_id,pdbId:d,labelAsymId:s.chain_id,authSeqId:s.author_residue_number})?showNotification(`Adding molecule ${s.chem_comp_id}...`,"success"):showNotification(`Molecule ${s.chem_comp_id} already exists`,"info")}),T.appendChild(j),h.appendChild(f),h.appendChild(y),h.appendChild(w),h.appendChild(E),h.appendChild(b),h.appendChild(L),h.appendChild(T),h}addAllLigands(s,d,h){if(!s||s.length===0){showNotification(`No ${d} ligands to add`,"info");return}const f=document.getElementById(`add-all-${d}-btn`);f.disabled=!0,f.textContent="Adding...";let v=0,y=0;s.forEach((p,w)=>{setTimeout(()=>{if(this.addMolecule({code:p.chem_comp_id,pdbId:h,labelAsymId:p.chain_id,authSeqId:p.author_residue_number})?v++:y++,w===s.length-1){let b="";v>0&&y>0?b=`Added ${v} new molecules, ${y} already existed`:v>0?b=`Added ${v} new molecules`:b=`All ${y} molecules already existed`,showNotification(b,v>0?"success":"info"),f.disabled=!1,f.textContent=`Add All (${s.length})`}},w*sa)})}}class fa{constructor(s,{notify:d=typeof window<"u"&&window.showNotification||(typeof showNotification=="function"?showNotification:()=>{}),smilesDrawer:h=typeof window<"u"&&window.SmilesDrawer||(typeof SmilesDrawer<"u"?SmilesDrawer:void 0)}={}){this.moleculeManager=s,this.fragments=[],this.grid=null,this.searchInput=null,this.sourceFilter=null,this.ccdToggle=null,this.notify=d,this.smilesDrawer=h}init(){return this.grid=document.getElementById("fragment-grid"),this.searchInput=document.getElementById("fragment-search"),this.sourceFilter=document.getElementById("fragment-filter-source"),this.ccdToggle=document.getElementById("ccd-toggle"),this.addEventListeners(),this}addEventListeners(){this.searchInput&&this.searchInput.addEventListener("input",()=>this.renderFragments()),this.sourceFilter&&this.sourceFilter.addEventListener("change",()=>this.renderFragments()),this.ccdToggle&&this.ccdToggle.addEventListener("change",()=>this.renderFragments())}async loadFragments(){try{const d=(await K.getFragmentLibraryTsv()).split(`
`).slice(1);this.fragments=d.map((h,f)=>{const v=h.split("	");return v.length<10?null:{id:v[0]||f,name:v[1],kind:v[2],query:v[3],description:v[4],comment:v[5],url:v[6],source:v[7],ccd:v[8],in_ccd:v[9].trim()==="True"}}).filter(Boolean),this.renderFragments()}catch(s){console.error("Failed to load fragment library:",s),this.grid&&(this.grid.innerHTML="<p>No fragments match your criteria.</p>")}}renderFragments(){if(!this.grid)return;this.grid.innerHTML="";const s=this.searchInput?this.searchInput.value.toLowerCase():"",d=this.sourceFilter?this.sourceFilter.value:"all",h=this.ccdToggle?this.ccdToggle.checked:!1,f=this.fragments.filter(y=>{const p=y.name.toLowerCase().includes(s),w=d==="all"||y.source===d,E=!h||y.in_ccd;return p&&w&&E});if(f.length===0){this.grid.innerHTML="<p>No fragments match your criteria.</p>";return}const v=document.createDocumentFragment();f.forEach(y=>{const p=this.createFragmentCard(y);v.appendChild(p)}),this.grid.appendChild(v)}createFragmentCard(s){const d=document.createElement("div");d.className="molecule-card fragment-card";const h=document.createElement("h3");h.textContent=s.name,d.appendChild(h);const f=document.createElement("div");f.className="viewer-container",d.appendChild(f);const v=document.createElement("div");v.className="fragment-info";let y="No";if(s.in_ccd&&s.ccd){const w=s.ccd.split(",")[0].trim();y=`Yes (<a href="#" class="ccd-link" data-ccd="${w}">${w}</a>)`}v.innerHTML=`
            <p><strong>Source:</strong> ${s.source}</p>
            <p><strong>In CCD:</strong> ${y}</p>
            <p><strong>Type:</strong> ${s.kind}</p>
        `,d.appendChild(v);const p=v.querySelector(".ccd-link");if(p&&p.addEventListener("click",w=>{w.preventDefault();const E=w.target.dataset.ccd;this.moleculeManager&&this.moleculeManager.showMoleculeDetails&&this.moleculeManager.showMoleculeDetails(E)}),s.in_ccd&&s.ccd){const w=s.ccd.split(",")[0].trim(),E=this.moleculeManager.getMolecule(w),b=document.createElement("button");b.textContent=E?"In library":"Add to library",b.className="add-to-library-btn",E&&(b.disabled=!0,b.classList.add("added")),b.addEventListener("click",L=>{L.stopPropagation(),this.moleculeManager.addMolecule(w)?(this.notify(`Adding molecule ${w} to library...`,"success"),b.textContent="Added to library",b.disabled=!0,b.classList.add("added")):(this.notify(`Molecule ${w} already exists.`,"info"),b.textContent="In library",b.disabled=!0,b.classList.add("added"))}),d.appendChild(b)}return setTimeout(()=>{if((s.kind==="SMILES"||s.kind==="SMARTS")&&s.query){const w=document.createElement("canvas");w.width=200,w.height=150,f.appendChild(w);try{const E=this.sanitizeSMILES(s.query);this.smilesDrawer.parse(E,b=>{const L={width:200,height:150};new this.smilesDrawer.Drawer(L).draw(b,w,"light",!1)},b=>{console.error("Error parsing SMILES for "+s.name,b),f.innerHTML=`<p class="render-error">Render error for query: ${s.query}</p>`})}catch(E){console.error("General error rendering SMILES for "+s.name,E),f.innerHTML=`<p class="render-error">Render error for query: ${s.query}</p>`}}else f.innerHTML=`<p class="render-error">Cannot render type: ${s.kind||"N/A"}</p>`},50),d}addFragment(s){return!s.name||!s.query?(this.notify("Fragment name and SMILES/SMARTS query are required.","error"),!1):(this.fragments.unshift({id:`custom-${Date.now()}`,name:s.name,kind:"SMILES",query:s.query,description:s.description,comment:"Custom fragment",url:"",source:s.source||"custom",ccd:"",in_ccd:!1}),this.renderFragments(),this.notify(`Fragment "${s.name}" added successfully!`,"success"),!0)}sanitizeSMILES(s){return s?s.replace(/[^A-Za-z0-9\(\)\[\]\.\-=#$:@\/\\]/g,""):""}}class ha{constructor(s){this.moleculeManager=s,this.modal=document.getElementById("molecule-details-modal"),this.detailsTitle=document.getElementById("details-title"),this.detailsCode=document.getElementById("details-code"),this.detailsSource=document.getElementById("details-source"),this.detailsType=document.getElementById("details-type"),this.detailsStructure=document.getElementById("details-structure"),this.pdbInstanceFields=document.querySelectorAll(".pdb-instance-field"),this.detailsPdbId=document.getElementById("details-pdb-id"),this.detailsChain=document.getElementById("details-chain"),this.detailsResidue=document.getElementById("details-residue"),this.detailsViewer=document.getElementById("details-viewer-container"),this.detailsJSON=document.getElementById("details-json"),this.viewer=null;const d=document.getElementById("close-details-modal");d&&d.addEventListener("click",()=>this.close()),window.addEventListener("click",h=>{h.target===this.modal&&this.close()})}show(s,d){this.cleanupViewer(),this.detailsTitle.textContent=`Molecule Details: ${s}`,this.detailsCode.textContent=s;const h=["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL"].includes(s);this.detailsSource.textContent=h?"building_blocks":"reagents",this.detailsType.textContent=h?"building_block":"reagent";const f=this.moleculeManager.getMolecule?this.moleculeManager.getMolecule(s):null,v=f&&f.pdbId&&f.authSeqId&&f.labelAsymId;this.detailsStructure&&(this.detailsStructure.textContent=v?"PDB instance":"Ideal CCD SDF"),this.pdbInstanceFields&&this.pdbInstanceFields.forEach(p=>{p.style.display=v?"flex":"none"}),v?(this.detailsPdbId&&(this.detailsPdbId.textContent=f.pdbId.toUpperCase()),this.detailsChain&&(this.detailsChain.textContent=f.labelAsymId),this.detailsResidue&&(this.detailsResidue.textContent=f.authSeqId)):(this.detailsPdbId&&(this.detailsPdbId.textContent="-"),this.detailsChain&&(this.detailsChain.textContent="-"),this.detailsResidue&&(this.detailsResidue.textContent="-")),this.detailsViewer.innerHTML="<p>Loading structure...</p>",v?K.getPdbFile(f.pdbId).then(p=>{setTimeout(()=>{try{const w=$3Dmol.createViewer(this.detailsViewer,{backgroundColor:"white",width:"100%",height:"100%"});w.addModel(p,"pdb"),w.setStyle({},{cartoon:{color:"lightgrey"}});const E={chain:f.labelAsymId,resi:parseInt(f.authSeqId,10)},b={within:{distance:5,sel:E}};w.setStyle(b,{stick:{radius:.15,colorscheme:"element"}}),w.setStyle(E,{stick:{radius:.2,colorscheme:"element"},sphere:{scale:.3,colorscheme:"element"}}),w.addSurface($3Dmol.SurfaceType.MS,{opacity:.6,color:"white"},b),w.zoomTo(E),w.render(),this.viewer=w}catch(w){console.error(`Error initializing PDB viewer for ${s}:`,w),this.detailsViewer.innerHTML='<p style="color: #666;">Structure rendering error</p>'}},100)}).catch(p=>{console.error(`Error fetching PDB for ${s}:`,p),this.detailsViewer.innerHTML='<p style="color: #666;">Structure data not available</p>'}):d?setTimeout(()=>{try{const p=$3Dmol.createViewer(this.detailsViewer,{backgroundColor:"white",width:"100%",height:"100%"});p.addModel(d,"sdf"),p.setStyle({},{stick:{radius:.2,colorscheme:"element"},sphere:{scale:.3,colorscheme:"element"}}),p.setStyle({elem:"H"},{}),p.zoomTo(),p.render(),this.viewer=p}catch(p){console.error(`Error initializing details viewer for ${s}:`,p),this.detailsViewer.innerHTML='<p style="color: #666;">Structure rendering error</p>'}},100):this.detailsViewer.innerHTML='<p style="color: #666;">Structure data not available</p>';const y={molecule_id:`mol_${s.toLowerCase()}`,ccd_code:s,source:h?"building_blocks":"reagents",type:h?"building_block":"reagent",structure_type:v?"pdb_instance":"ideal_sdf",structure_data:d?d.substring(0,100)+"...":"N/A",properties:{molecular_weight:null,formula:null,status:f?f.status:"unknown"}};v&&(y.pdb_instance={pdb_id:f.pdbId,auth_seq_id:f.authSeqId,label_asym_id:f.labelAsymId}),this.detailsJSON.textContent=JSON.stringify(y,null,2),this.modal.style.display="block"}close(){this.cleanupViewer(),this.modal.style.display="none"}cleanupViewer(){var s,d;if(this.viewer){try{this.viewer.clear(),typeof this.viewer.destroy=="function"?this.viewer.destroy():(s=this.viewer)!=null&&s.gl&&typeof this.viewer.gl.getExtension=="function"&&((d=this.viewer.gl.getExtension("WEBGL_lose_context"))==null||d.loseContext())}catch(h){console.warn("Error destroying viewer:",h)}this.viewer=null}this.detailsViewer&&(this.detailsViewer.innerHTML="")}}class pa{constructor(s){this.moleculeManager=s,this.currentSimilarLigands=[]}async load(s){var y,p,w,E,b,L,T,j,R;const d=document.getElementById("similar-ligands-container"),h=document.getElementById("similar-ligands-table"),f=document.getElementById("similar-ligands-tbody"),v=document.getElementById("add-all-similar-btn");this.currentSimilarLigands=[];try{d.innerHTML="<p>Loading similar ligands...</p>",h.style.display="none",v.style.display="none";const z=(await K.getSimilarCcds(s))[s];if(!z||!((p=(y=z[0])==null?void 0:y.stereoisomers)!=null&&p.length)&&!((E=(w=z[0])==null?void 0:w.same_scaffold)!=null&&E.length)&&!((L=(b=z[0])==null?void 0:b.similar_ligands)!=null&&L.length)){d.innerHTML='<div class="no-similar-ligands">No similar ligands found</div>';return}f.innerHTML="";const Q=(X,ie)=>{ie.forEach(se=>{this.currentSimilarLigands.push(se);const _e=this.createSimilarLigandRow(X,se);f.appendChild(_e)})};(T=z[0])!=null&&T.stereoisomers&&Q("stereoisomer",z[0].stereoisomers),(j=z[0])!=null&&j.same_scaffold&&Q("scaffold",z[0].same_scaffold),(R=z[0])!=null&&R.similar_ligands&&Q("similar",z[0].similar_ligands),d.style.display="none",h.style.display="table",this.currentSimilarLigands.length>0&&(v.style.display="inline-block",v.textContent=`Add All (${this.currentSimilarLigands.length})`,v.replaceWith(v.cloneNode(!0)),document.getElementById("add-all-similar-btn").addEventListener("click",()=>this.addAllSimilarLigands()))}catch(H){console.error(`Error fetching similar CCDs for ${s}:`,H),d.innerHTML='<div class="no-similar-ligands">Similar ligands feature temporarily unavailable due to CORS restrictions. <br><small>In production, this would be handled via a backend proxy.</small></div>',s==="ATP"&&this.showDemoSimilarLigands()}}addAllSimilarLigands(){if(!this.currentSimilarLigands||this.currentSimilarLigands.length===0){showNotification("No similar ligands to add","info");return}const s=document.getElementById("add-all-similar-btn");s.disabled=!0,s.textContent="Adding...";let d=0,h=0;this.currentSimilarLigands.forEach((f,v)=>{setTimeout(()=>{if(this.moleculeManager.addMolecule(f.chem_comp_id)?d++:h++,v===this.currentSimilarLigands.length-1){let p="";d>0&&h>0?p=`Added ${d} new molecules, ${h} already existed`:d>0?p=`Added ${d} new molecules`:p=`All ${h} molecules already existed`,showNotification(p,d>0?"success":"info"),s.disabled=!1,s.textContent=`Add All (${this.currentSimilarLigands.length})`}},v*100)})}createSimilarLigandRow(s,d){const h=document.createElement("tr"),f=document.createElement("td");f.className="structure-2d";const v=document.createElement("div");v.className="loading",v.textContent="Loading...",f.appendChild(v),this.load2DStructure(d.chem_comp_id,v);const y=document.createElement("td"),p=document.createElement("span");p.className=`type-badge type-${s}`;let w="";switch(s){case"stereoisomer":w="Stereoisomer";break;case"scaffold":w="Same Scaffold";break;case"similar":w="Similar";break}p.textContent=w,y.appendChild(p);const E=document.createElement("td"),b=document.createElement("span");b.className="ccd-code",b.textContent=d.chem_comp_id,b.title=`Click to add ${d.chem_comp_id} to database`,b.addEventListener("click",()=>{document.getElementById("close-details-modal").click(),this.moleculeManager.showMoleculeDetails(d.chem_comp_id)}),E.appendChild(b);const L=document.createElement("td");L.className="ligand-name",L.textContent=d.name||"N/A";const T=document.createElement("td");if(T.className="match-info",d.similarity_score){const H=Math.round(d.similarity_score*100);T.textContent=`${H}% similarity`}else d.substructure_match&&d.substructure_match.length>0?T.textContent=d.substructure_match.join(", "):T.textContent="-";const j=document.createElement("td"),R=document.createElement("button");return R.className="add-ligand-btn",R.innerHTML="&#43;",R.title=`Add ${d.chem_comp_id} to database`,R.addEventListener("click",()=>{this.moleculeManager.addMolecule(d.chem_comp_id)?showNotification(`Adding molecule ${d.chem_comp_id}...`,"success"):showNotification(`Molecule ${d.chem_comp_id} already exists`,"info")}),j.appendChild(R),h.appendChild(f),h.appendChild(y),h.appendChild(E),h.appendChild(L),h.appendChild(T),h.appendChild(j),h}async load2DStructure(s,d){try{const h=`${Dt}/${s.toUpperCase()}_200.svg`,f=document.createElement("img");f.src=h,f.alt=`2D structure of ${s}`,f.onload=()=>{d.innerHTML="",d.appendChild(f)},f.onerror=()=>{const v=`${Dt}/${s.toLowerCase()}_200.svg`,y=document.createElement("img");y.src=v,y.alt=`2D structure of ${s}`,y.onload=()=>{d.innerHTML="",d.appendChild(y)},y.onerror=()=>{d.className="error",d.textContent="No image"}}}catch(h){console.error(`Error loading 2D structure for ${s}:`,h),d.className="error",d.textContent="Error"}}showDemoSimilarLigands(){const s=document.getElementById("similar-ligands-container"),d=document.getElementById("similar-ligands-table"),h=document.getElementById("similar-ligands-tbody"),f=[{type:"stereoisomer",chem_comp_id:"HEJ",name:"9-{5-O-[(S)-hydroxy{[(R)-hydroxy(phosphonooxy)phosphoryl]oxy}phosphoryl]-beta-D-arabinofuranosyl}-9H-purin-6-amine",substructure_match:[]},{type:"scaffold",chem_comp_id:"E7X",name:"(2~{S})-4-[[(2~{R},3~{S},4~{R},5~{R})-5-(6-aminopurin-9-yl)-3,4-bis(oxidanyl)oxolan-2-yl]methyl-(2-hydroxyethyl)amino]-2-azaniumyl-butanoate",substructure_match:["N7"]},{type:"scaffold",chem_comp_id:"ADP",name:"Adenosine 5-diphosphate",substructure_match:["N1","N3","N7","N9"]}];h.innerHTML="",f.forEach(v=>{const y=this.createSimilarLigandRow(v.type,v);h.appendChild(y)}),s.innerHTML='<div style="background: #e8f5e8; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-size: 13px;"><strong>Demo Data:</strong> Showing sample similar ligands for ATP. In production, this would fetch real data from the PDBe API.</div>',d.style.display="table"}}class ma{constructor(s){this.moleculeManager=s}async load(s){const d=document.getElementById("pdb-entries-container"),h=document.getElementById("pdb-entries-table-container"),f=document.getElementById("pdb-entries-tbody");try{d.innerHTML="<p>Loading PDB entries...</p>",f.innerHTML="",h.style.display="none",h.querySelectorAll('p[style*="font-size: 12px"]').forEach(E=>E.remove());const p=(await K.getPdbEntriesForCcd(s))[s];if(!p||p.length===0){d.innerHTML='<div class="no-pdb-entries">No PDB entries found containing this CCD code</div>';return}f.innerHTML="";const w=p.slice(0,10);console.log(`Found ${p.length} PDB entries for ${s}, showing first ${w.length}`);for(const E of w)try{const b=await this.moleculeManager.fetchRCSBDetails(E),L=this.createDetailedPDBEntryRow(E,b);f.appendChild(L)}catch(b){console.warn(`Failed to fetch details for ${E}:`,b);const L=this.createSimplePDBEntryRow(E);f.appendChild(L)}if(d.style.display="none",h.style.display="block",p.length>10){const E=document.createElement("p");E.style.fontSize="12px",E.style.color="#666",E.style.fontStyle="italic",E.style.marginTop="10px",E.textContent=`Showing first 10 of ${p.length} PDB entries containing ${s}`,h.appendChild(E)}}catch(v){console.error(`Error fetching PDB entries for ${s}:`,v),f.innerHTML="",h.style.display="none",d.innerHTML='<div class="no-pdb-entries">PDB entries feature temporarily unavailable due to CORS restrictions. <br><small>In production, this would be handled via a backend proxy.</small></div>',s==="ATP"&&this.showDemoPDBEntries()}}createDetailedPDBEntryRow(s,d){const h=document.createElement("tr"),f=document.createElement("td"),v=document.createElement("span");v.className="pdb-id",v.textContent=s.toUpperCase(),v.title=`Click to view details for ${s.toUpperCase()}`,v.addEventListener("click",()=>{this.moleculeManager.showPDBDetailsModal(s)}),f.appendChild(v);const y=document.createElement("td");y.className="pdb-title",d&&d.struct&&d.struct.title?(y.textContent=d.struct.title,y.title=d.struct.title):y.textContent="N/A";const p=document.createElement("td");p.className="pdb-resolution",d&&d.rcsb_entry_info&&d.rcsb_entry_info.resolution_combined&&d.rcsb_entry_info.resolution_combined.length>0?p.textContent=`${d.rcsb_entry_info.resolution_combined[0].toFixed(2)}`:p.textContent="N/A";const w=document.createElement("td");if(w.className="pdb-date",d&&d.rcsb_accession_info&&d.rcsb_accession_info.initial_release_date){const T=new Date(d.rcsb_accession_info.initial_release_date);w.textContent=T.toLocaleDateString()}else w.textContent="N/A";const E=document.createElement("td");E.className="view-buttons-cell";const b=document.createElement("button");b.textContent="RCSB PDB",b.className="view-structure-btn rcsb-btn",b.title=`View ${s.toUpperCase()} on RCSB PDB`,b.addEventListener("click",()=>{window.open(`${Ke}/${s.toUpperCase()}`,"_blank")});const L=document.createElement("button");return L.textContent="PDBe",L.className="view-structure-btn pdbe-btn",L.title=`View ${s.toUpperCase()} on PDBe`,L.addEventListener("click",()=>{window.open(`${Ze}/${s.toLowerCase()}`,"_blank")}),E.appendChild(b),E.appendChild(L),h.appendChild(f),h.appendChild(y),h.appendChild(p),h.appendChild(w),h.appendChild(E),h}createSimplePDBEntryRow(s){const d=document.createElement("tr"),h=document.createElement("td"),f=document.createElement("span");f.className="pdb-id",f.textContent=s.toUpperCase(),f.title=`Click to view details for ${s.toUpperCase()}`,f.addEventListener("click",()=>{this.moleculeManager.showPDBDetailsModal(s)}),h.appendChild(f);const v=document.createElement("td");v.textContent="Loading...",v.className="pdb-title";const y=document.createElement("td");y.textContent="N/A",y.className="pdb-resolution";const p=document.createElement("td");p.textContent="N/A",p.className="pdb-date";const w=document.createElement("td");w.className="view-buttons-cell";const E=document.createElement("button");E.textContent="RCSB PDB",E.className="view-structure-btn rcsb-btn",E.title=`View ${s.toUpperCase()} on RCSB PDB`,E.addEventListener("click",()=>{window.open(`${Ke}/${s.toUpperCase()}`,"_blank")});const b=document.createElement("button");return b.textContent="PDBe",b.className="view-structure-btn pdbe-btn",b.title=`View ${s.toUpperCase()} on PDBe`,b.addEventListener("click",()=>{window.open(`${Ze}/${s.toLowerCase()}`,"_blank")}),w.appendChild(E),w.appendChild(b),d.appendChild(h),d.appendChild(v),d.appendChild(y),d.appendChild(p),d.appendChild(w),d}showDemoPDBEntries(){const s=document.getElementById("pdb-entries-container"),d=document.getElementById("pdb-entries-table-container"),h=document.getElementById("pdb-entries-tbody");h.innerHTML="",d.querySelectorAll('p[style*="font-size: 12px"]').forEach(y=>y.remove()),[{pdb_id:"1atp",title:"CRYSTAL STRUCTURE OF THE TERNARY COMPLEX OF PHENYLALANYL-TRNA SYNTHETASE WITH TRNA AND A PHENYLALANYL-ADENYLATE ANALOGUE",resolution:2.7,release_date:"1995-01-31"},{pdb_id:"2atp",title:"ADENOSINE-5'-TRIPHOSPHATE",resolution:1.83,release_date:"1996-07-17"},{pdb_id:"3atp",title:"ATP SYNTHASE",resolution:2.4,release_date:"1999-02-24"},{pdb_id:"1a49",title:"CRYSTAL STRUCTURE OF ADENYLYL CYCLASE",resolution:2.8,release_date:"1998-04-15"},{pdb_id:"1a5u",title:"ATP BINDING CASSETTE TRANSPORTER",resolution:3.2,release_date:"1998-08-12"}].forEach(y=>{const p={struct:{title:y.title},rcsb_entry_info:{resolution_combined:[y.resolution]},rcsb_accession_info:{initial_release_date:y.release_date}},w=this.createDetailedPDBEntryRow(y.pdb_id,p);h.appendChild(w)}),s.innerHTML='<div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; font-size: 12px; margin-bottom: 10px;">Demo data shown due to CORS restrictions. In production, this would show all PDB entries containing ATP.</div>',d.style.display="block"}}const va="https://data.rcsb.org/rest/v1/core/chemcomp";class ga{static async getProperties(s){try{const d=await fetch(`${va}/${s.toUpperCase()}`);if(!d.ok)throw new Error(`HTTP error ${d.status}`);const h=await d.json(),f=(h==null?void 0:h.chem_comp)||{};return{molecularWeight:f.formula_weight??null,formula:f.formula??null}}catch(d){return console.error(`Failed to fetch properties for ${s}:`,d),null}}}class ya{constructor(s){this.details=new ha(s),this.similarLigandTable=new pa(s),this.pdbEntryList=new ma(s),this.propertiesContainer=document.getElementById("ligand-properties")}show(s,d){this.details.show(s,d),this.similarLigandTable.load(s),this.pdbEntryList.load(s),this.propertiesContainer&&(this.propertiesContainer.textContent="Loading properties...",Promise.all([ga.getProperties(s).catch(()=>null),K.getPubChemMetadata(s).catch(()=>null)]).then(([h,f])=>{var w,E,b;if(!h&&!f){this.propertiesContainer.textContent="Properties unavailable";return}let v="";const y=((w=f==null?void 0:f.properties)==null?void 0:w.MolecularWeight)??(h==null?void 0:h.molecularWeight),p=((E=f==null?void 0:f.properties)==null?void 0:E.MolecularFormula)??(h==null?void 0:h.formula);(y||p)&&(v+=`<div>Molecular Weight: ${y??"N/A"}</div>`,v+=`<div>Formula: ${p??"N/A"}</div>`),(b=f==null?void 0:f.properties)!=null&&b.IUPACName&&(v+=`<div>IUPAC Name: ${f.properties.IUPACName}</div>`),f!=null&&f.synonyms&&f.synonyms.length&&(v+=`<div>Synonyms: ${f.synonyms.slice(0,5).join(", ")}</div>`),f!=null&&f.link&&(v+=`<div><a href="${f.link}" target="_blank">PubChem Entry</a></div>`),this.propertiesContainer.innerHTML=v}).catch(()=>{this.propertiesContainer.textContent="Properties unavailable"}))}close(){this.details.close()}load2DStructure(s,d){return this.similarLigandTable.load2DStructure(s,d)}}class wa{constructor(s,d,h={}){this.grid=s,this.repository=d,this.onDelete=h.onDelete,this.onShowDetails=h.onShowDetails,this.onCompare=h.onCompare,this.draggedElement=null}createMoleculeCardFromSmiles(s,d,h=d){const f=document.createElement("div");f.className="molecule-card",f.draggable=!0,f.setAttribute("data-molecule-code",d),f.setAttribute("data-molecule-id",h);const v=document.createElement("div");v.className="drag-handle",v.innerHTML="⋯",f.appendChild(v);const y=document.createElement("div");y.className="delete-btn",y.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>',y.title=`Delete ${d}`,y.addEventListener("click",T=>{T.stopPropagation(),this.onDelete&&this.onDelete(d)}),f.appendChild(y);const p=document.createElement("div");p.className="download-btn",p.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7Z"/></svg>',p.title=`Download ${d} as SDF`,p.addEventListener("click",T=>{T.stopPropagation(),this.downloadSdf(d)}),f.appendChild(p);const w=document.createElement("div");w.className="compare-btn",w.textContent="⇆",w.title=`Compare ${d}`,w.addEventListener("click",T=>{T.stopPropagation(),this.onCompare&&this.onCompare(d)}),f.appendChild(w);const E=document.createElement("div");E.className="molecule-code",E.textContent=d,f.appendChild(E);const b=document.createElement("div");b.className="molecule-viewer",b.id=`viewer-${d}`,f.appendChild(b);const L=document.createElement("div");L.className="smiles-label",L.textContent=`SMILES: ${s}`,L.style.fontSize="10px",L.style.color="#666",L.style.marginTop="5px",f.appendChild(L),this.grid.appendChild(f),this.renderSmilesIn2D(s,b),this.addDragEvents(f)}renderSmilesIn2D(s,d){d.innerHTML=`
            <div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;">
                <div style="text-align:center;padding:10px;">
                    <div style="font-size:24px;margin-bottom:5px;">🧪</div>
                    <div style="font-size:10px;color:#666;">SMILES</div>
                </div>
            </div>
        `}createMoleculeCard(s,d,h="sdf",f=d){const v=document.createElement("div");v.className="molecule-card",v.draggable=!0,v.setAttribute("data-molecule-code",d),v.setAttribute("data-molecule-id",f);const y=document.createElement("div");y.className="drag-handle",y.innerHTML="⋯",v.appendChild(y);const p=document.createElement("div");p.className="delete-btn",p.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>',p.title=`Delete ${d}`,p.addEventListener("click",T=>{T.stopPropagation(),this.onDelete&&this.onDelete(d)}),v.appendChild(p);const w=document.createElement("div");w.className="download-btn",w.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7Z"/></svg>',w.title=`Download ${d} as SDF`,w.addEventListener("click",T=>{T.stopPropagation(),this.downloadSdf(d,s)}),v.appendChild(w);const E=document.createElement("div");E.className="compare-btn",E.textContent="⇆",E.title=`Compare ${d}`,E.addEventListener("click",T=>{T.stopPropagation(),this.onCompare&&this.onCompare(d)}),v.appendChild(E);const b=document.createElement("h3");b.textContent=d,b.style.cursor="pointer",b.addEventListener("click",()=>{this.onShowDetails&&this.onShowDetails(d,s,h)}),v.appendChild(b);const L=document.createElement("div");L.id=`viewer-${d}`,L.className="viewer-container",v.appendChild(L),this.grid.appendChild(v),this.addDragEvents(v),setTimeout(()=>{try{const T=$3Dmol.createViewer(L,{backgroundColor:"white"});T.addModel(s,h),T.setStyle({},{stick:{}}),T.setStyle({elem:"H"},{}),T.zoomTo(),T.render()}catch(T){console.error(`Error initializing 3Dmol viewer for ${d}:`,T),L.innerHTML='<p style="text-align:center;padding:20px;">Render Error</p>'}},100)}createNotFoundCard(s,d="Not found",h=s){const f=document.createElement("div");f.className="molecule-card",f.draggable=!0,f.setAttribute("data-molecule-code",s),f.setAttribute("data-molecule-id",h);const v=document.createElement("div");v.className="drag-handle",v.innerHTML="⋯",f.appendChild(v);const y=document.createElement("div");y.className="delete-btn",y.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>',y.title=`Delete ${s}`,y.addEventListener("click",E=>{E.stopPropagation(),this.onDelete&&this.onDelete(s)}),f.appendChild(y);const p=document.createElement("div");p.className="download-btn",p.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7Z"/></svg>',p.title=`Download ${s} as SDF`,p.addEventListener("click",E=>{E.stopPropagation(),this.downloadSdf(s)}),f.appendChild(p);const w=document.createElement("div");w.className="not-found-content",w.innerHTML=`<h3>${s}</h3><p>${d}</p>`,f.appendChild(w),this.grid.appendChild(f),this.addDragEvents(f)}addDragEvents(s){s.addEventListener("dragstart",d=>this.handleDragStart(d)),s.addEventListener("dragover",d=>this.handleDragOver(d)),s.addEventListener("drop",d=>this.handleDrop(d)),s.addEventListener("dragend",d=>this.handleDragEnd(d))}handleDragStart(s){this.draggedElement=s.currentTarget,s.currentTarget.classList.add("dragging"),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/html",s.currentTarget.outerHTML)}handleDragOver(s){return s.preventDefault&&s.preventDefault(),s.dataTransfer.dropEffect="move",!1}handleDrop(s){if(s.stopPropagation&&s.stopPropagation(),this.draggedElement!==s.currentTarget){const d=Array.from(this.grid.querySelectorAll(".molecule-card")),h=d.indexOf(this.draggedElement),f=d.indexOf(s.currentTarget);h<f?s.currentTarget.parentNode.insertBefore(this.draggedElement,s.currentTarget.nextSibling):s.currentTarget.parentNode.insertBefore(this.draggedElement,s.currentTarget);const v=this.repository.molecules,y=this.draggedElement.getAttribute("data-molecule-code"),p=s.currentTarget.getAttribute("data-molecule-code"),w=v.findIndex(b=>b.code===y),E=v.findIndex(b=>b.code===p);if(w>-1&&E>-1){const[b]=v.splice(w,1);v.splice(E,0,b)}}return!1}handleDragEnd(s){s.currentTarget.classList.remove("dragging"),this.draggedElement=null}async downloadSdf(s,d){try{let h=d;if(h||(h=await K.getCcdSdf(s)),!h)throw new Error("No SDF data available");const f=new Blob([h],{type:"chemical/x-mdl-sdfile"}),v=URL.createObjectURL(f),y=document.createElement("a");y.href=v,y.download=`${s}.sdf`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(v)}catch(h){console.error(`Failed to download SDF for ${s}:`,h)}}clearAll(){this.grid.querySelectorAll(".molecule-card").forEach(d=>d.remove())}}class _a{constructor(s){this.boundLigandTable=s,this.modal=document.getElementById("pdb-details-modal");const d=document.getElementById("close-pdb-details-modal");d&&d.addEventListener("click",()=>this.close()),window.addEventListener("click",h=>{h.target===this.modal&&this.close()})}async fetchRCSBDetails(s){try{return await K.getRcsbEntry(s)}catch(d){return console.error(`Error fetching RCSB details for PDB ${s}:`,d),null}}async showPDBDetailsModal(s){const d=document.getElementById("pdb-details-title"),h=document.getElementById("pdb-details-body"),f=document.getElementById("pdb-viewer-container");d.textContent=`PDB Entry Details: ${s.toUpperCase()}`,h.innerHTML='<div class="properties-loading">Loading PDB entry details...</div>',f.innerHTML="",f.style.display="none",this.modal.style.display="block";try{const v=await this.fetchRCSBDetails(s);if(!v)throw new Error("No data found for this PDB entry.");h.innerHTML=this.createPDBDetailsHTML(v),this.boundLigandTable&&this.boundLigandTable.populateBoundLigands(s),document.getElementById("open-rcsb-btn").addEventListener("click",()=>{window.open(`${Ke}/${s.toUpperCase()}`,"_blank")}),document.getElementById("open-pdbe-btn").addEventListener("click",()=>{window.open(`${Ze}/${s.toLowerCase()}`,"_blank")}),f.style.display="block",f.innerHTML='<p class="properties-loading">Loading 3D structure...</p>';const y=await K.getPdbFile(s);setTimeout(()=>{try{const p=$3Dmol.createViewer(f,{backgroundColor:"white",width:"100%",height:"100%"});p.addModel(y,"pdb"),p.setStyle({},{cartoon:{color:"spectrum"}}),p.zoomTo(),p.render()}catch(p){console.error("Error creating 3Dmol viewer:",p),f.innerHTML='<div class="no-pdb-entries">Could not render 3D structure.</div>'}},100)}catch(v){console.error("Error fetching PDB details:",v),h.innerHTML='<div class="no-pdb-entries">Could not load details for this PDB entry.</div>',f.style.display="none";const y=v.status&&v.url?`Failed to load PDB details (status ${v.status}) from ${v.url}`:"Failed to load PDB entry details.";typeof showNotification=="function"&&showNotification(y,"error")}}close(){this.modal&&(this.modal.style.display="none")}createPDBDetailsHTML(s){var E,b,L,T,j,R,H,z,Q,X,ie,se;const d=((E=s.struct)==null?void 0:E.title)||"Not available",h=((T=(L=(b=s.citation)==null?void 0:b[0])==null?void 0:L.rcsb_authors)==null?void 0:T.join(", "))||"Not available",f=(j=s.rcsb_accession_info)!=null&&j.initial_release_date?new Date(s.rcsb_accession_info.initial_release_date).toLocaleDateString():"Not available",v=(z=(H=(R=s.rcsb_entry_info)==null?void 0:R.resolution_combined)==null?void 0:H[0])!=null&&z.toFixed(2)?`${s.rcsb_entry_info.resolution_combined[0].toFixed(2)} Å`:"N/A",y=((X=(Q=s.exptl)==null?void 0:Q[0])==null?void 0:X.method)||"N/A",p=((se=(ie=s.entity_src_gen)==null?void 0:ie[0])==null?void 0:se.pdbx_host_org_scientific_name)||"Not available";return`
            <div class="details-section" style="padding-bottom: 0;">
                <div class="pdb-details-grid" style="grid-template-columns: repeat(5, 1fr);">
                    <div class="pdb-info-item">
                        <div class="pdb-info-label">PDB ID</div>
                        <div class="pdb-info-value">${s.rcsb_id.toUpperCase()}</div>
                    </div>
                    <div class="pdb-info-item">
                        <div class="pdb-info-label">Organism</div>
                        <div class="pdb-info-value">${p}</div>
                    </div>
                    <div class="pdb-info-item">
                        <div class="pdb-info-label">Method</div>
                        <div class="pdb-info-value">${y}</div>
                    </div>
                    <div class="pdb-info-item">
                        <div class="pdb-info-label">Resolution</div>
                        <div class="pdb-info-value">${v}</div>
                    </div>
                    <div class="pdb-info-item">
                        <div class="pdb-info-label">Release Date</div>
                        <div class="pdb-info-value">${f}</div>
                    </div>
                </div>
            </div>
            <div class="details-section" style="padding-top: 0;">
                 <div class="pdb-details-grid">
                    <div class="pdb-info-item" style="grid-column: 1 / -1;">
                        <div class="pdb-info-label">Title</div>
                        <div class="pdb-info-value" title="${d}">${d}</div>
                    </div>
                    <div class="pdb-info-item" style="grid-column: 1 / -1;">
                        <div class="pdb-info-label">Authors</div>
                        <div class="pdb-info-value">${h}</div>
                    </div>
                </div>
                <div class="pdb-external-links">
                    <button id="open-rcsb-btn" class="view-structure-btn rcsb-btn">RCSB PDB</button>
                    <button id="open-pdbe-btn" class="view-structure-btn pdbe-btn">PDBe</button>
                </div>
            </div>
            <div class="details-section">
                <h4>Interactive Molecular Structure</h4>
            </div>
        `}}const ba=["ATP","NAG","FAD","HEM","NAD","ADP","SAM","FMN","GDP","GTP"];class Ea{constructor(s){this.moleculeManager=s,this.modal=document.getElementById("add-molecule-modal"),this.codeInput=document.getElementById("molecule-code"),this.errorText=document.getElementById("ccd-error"),this.confirmBtn=document.getElementById("confirm-add-btn"),this.cancelBtn=document.getElementById("cancel-btn"),this.closeBtn=document.getElementById("close-modal"),this.luckyBtn=document.getElementById("feeling-lucky-btn"),this.pdbIdInput=document.getElementById("pdb-id"),this.authSeqIdInput=document.getElementById("auth-seq-id"),this.labelAsymIdInput=document.getElementById("label-asym-id"),this.instanceError=document.getElementById("instance-error"),this.cancelBtn&&this.cancelBtn.addEventListener("click",()=>this.close()),this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.close()),window.addEventListener("click",d=>{d.target===this.modal&&this.close()}),this.codeInput&&this.codeInput.addEventListener("input",()=>this.handleInput()),this.pdbIdInput&&this.pdbIdInput.addEventListener("input",()=>this.handleInstanceInput()),this.authSeqIdInput&&this.authSeqIdInput.addEventListener("input",()=>this.handleInstanceInput()),this.labelAsymIdInput&&this.labelAsymIdInput.addEventListener("input",()=>this.handleInstanceInput()),this.confirmBtn&&this.confirmBtn.addEventListener("click",()=>this.handleSubmit()),this.luckyBtn&&(this.luckyCodes=ba,this.luckyCodes.length>0&&this.luckyBtn.addEventListener("click",()=>this.handleLucky()))}open(){this.modal&&(this.reset(),this.modal.style.display="block",this.codeInput.focus())}close(){this.modal&&(this.modal.style.display="none")}reset(){this.codeInput&&(this.codeInput.value=""),this.errorText&&(this.errorText.textContent=""),this.instanceError&&(this.instanceError.textContent=""),this.pdbIdInput&&(this.pdbIdInput.value=""),this.authSeqIdInput&&(this.authSeqIdInput.value=""),this.labelAsymIdInput&&(this.labelAsymIdInput.value=""),this.confirmBtn&&(this.confirmBtn.disabled=!0)}handleInput(){let s=this.codeInput.value.toUpperCase();this.codeInput.value=s;const d=/^[A-Z0-9]{3}$/.test(s);this.errorText&&(this.errorText.textContent=d?"":"Code must be 3 alphanumeric characters."),this.confirmBtn&&(this.confirmBtn.disabled=!d)}handleInstanceInput(){this.instanceError&&(this.instanceError.textContent="")}handleLucky(){if(!this.luckyCodes||this.luckyCodes.length===0)return;let s,d=0;do s=this.luckyCodes[Math.floor(Math.random()*this.luckyCodes.length)],d++;while(this.moleculeManager.getMolecule(s)&&d<10);this.moleculeManager.addMolecule(s)?window.showNotification(`Adding molecule ${s}...`,"success"):window.showNotification(`Molecule ${s} already exists`,"info"),this.close()}handleSubmit(){const s=this.codeInput.value.toUpperCase(),d=this.pdbIdInput.value.trim().toUpperCase(),h=this.authSeqIdInput.value.trim(),f=this.labelAsymIdInput.value.trim().toUpperCase();if(d||h||f){if(!(d&&h&&f)){this.instanceError&&(this.instanceError.textContent="PDB ID, residue number and chain are required.");return}this.moleculeManager.addPdbInstance({code:s,pdbId:d,authSeqId:h,labelAsymId:f})?window.showNotification(`Adding ligand ${s} from ${d}...`,"success"):window.showNotification(`Ligand ${s} instance already exists`,"info")}else this.moleculeManager.addMolecule(s)?window.showNotification(`Adding molecule ${s}...`,"success"):window.showNotification(`Molecule ${s} already exists`,"info");this.close()}}class ka{constructor(s){this.moleculeManager=s,this.searchBtn=null,this.searchInput=null,this.suggestedDropdown=null,this.resultsContainer=null,this.resultsBody=null,this.loadingIndicator=null,this.noResultsMessage=null,this.hideAidsToggle=null,this.currentProteinDetails=[]}init(){return this.searchBtn=document.getElementById("protein-group-search-btn"),this.searchInput=document.getElementById("protein-group-search"),this.suggestedDropdown=document.getElementById("suggested-groups-dropdown"),this.resultsContainer=document.getElementById("protein-results-table-container"),this.resultsBody=document.getElementById("protein-results-tbody"),this.loadingIndicator=document.getElementById("protein-loading-indicator"),this.noResultsMessage=document.getElementById("no-protein-results-message"),this.hideAidsToggle=document.getElementById("hide-aids-toggle"),this.searchBtn&&this.searchBtn.addEventListener("click",()=>{const s=this.searchInput.value.trim();s?this.fetchProteinGroup(s):showNotification("Please enter a Group ID.","info")}),this.hideAidsToggle&&this.hideAidsToggle.addEventListener("change",()=>{this.currentProteinDetails.length>0&&this.displayResults(this.currentProteinDetails)}),this.suggestedDropdown&&this.suggestedDropdown.addEventListener("change",()=>{const s=this.suggestedDropdown.value;s&&(this.searchInput&&(this.searchInput.value=s),this.fetchProteinGroup(s))}),this}async fetchProteinGroup(s){this.loadingIndicator.style.display="block",this.resultsContainer.style.display="none",this.noResultsMessage.style.display="none";try{const h=(await K.getProteinGroup(s)).rcsb_group_container_identifiers.group_member_ids;this.currentProteinDetails=await this.fetchMemberDetails(h),this.displayResults(this.currentProteinDetails)}catch(d){console.error("Error fetching protein group:",d),this.noResultsMessage.textContent="Could not fetch data for the given Group ID.",this.noResultsMessage.style.display="block";const h=d.status&&d.url?`Failed to fetch protein group (status ${d.status}) from ${d.url}`:"Failed to fetch protein group data.";typeof showNotification=="function"&&showNotification(h,"error")}finally{this.loadingIndicator.style.display="none"}}async fetchMemberDetails(s){const d=[];for(const h of s)try{const f=await K.getRcsbEntry(h);d.push(f)}catch{d.push({rcsb_id:h,error:"Failed to fetch details"})}return d}async fetchBoundLigands(s){try{return(await K.getLigandMonomers(s))[s.toLowerCase()]||[]}catch(d){return console.error(`Error fetching bound ligands for ${s}:`,d),[]}}renderBoundLigands(s,d){if(!s||s.length===0)return'<div class="bound-ligands-container"></div>';const h=s.slice(0,5).map(v=>`
            <div class="ligand-img-container">
                <img src="${Dt}/${v.chem_comp_id}_200.svg" alt="${v.chem_comp_id}" title="${v.chem_comp_id}: ${v.chem_comp_name}" class="bound-ligand-img">
                <div class="ligand-img-overlay">
                    <button class="ligand-action-btn add-ligand" data-ccd-code="${v.chem_comp_id}" data-pdb-id="${d}" data-label-asym-id="${v.chain_id}" data-auth-seq-id="${v.author_residue_number}">+</button>
                </div>
            </div>
        `).join(""),f=s.length>5?`<span class="more-ligands-indicator" title="${s.length-5} more ligands">+${s.length-5}</span>`:"";return`<div class="bound-ligands-container">${h}${f}</div>`}async displayResults(s){var d,h,f,v,y;if(this.resultsBody.innerHTML="",s&&s.length>0){const p=this.hideAidsToggle&&this.hideAidsToggle.checked;for(const w of s){const E=this.resultsBody.insertRow(),b=w.rcsb_id,L=((d=w.struct)==null?void 0:d.title)||"N/A",T=((v=(f=(h=w.rcsb_entry_info)==null?void 0:h.resolution_combined)==null?void 0:f[0])==null?void 0:v.toFixed(2))||"N/A",j=(y=w.rcsb_accession_info)!=null&&y.initial_release_date?new Date(w.rcsb_accession_info.initial_release_date).toLocaleDateString():"N/A",R=`${ia}/${b.toLowerCase()}_assembly-1.jpeg`;let H=await this.fetchBoundLigands(b);p&&(H=H.filter(z=>!la.includes(z.chem_comp_id))),E.innerHTML=`
                    <td><img src="${R}" alt="${b} thumbnail" class="protein-thumbnail"></td>
                    <td><a href="#" class="pdb-id-link" data-pdb-id="${b}">${b}</a></td>
                    <td>${L}</td>
                    <td>${T}</td>
                    <td>${j}</td>
                    <td class="bound-ligands-cell">${this.renderBoundLigands(H,b)}</td>
                    <td class="view-buttons-cell">
                        <button class="view-structure-btn rcsb-btn" data-pdb-id="${b}">RCSB PDB</button>
                        <button class="view-structure-btn pdbe-btn" data-pdb-id="${b}">PDBe</button>
                    </td>
                `}this.resultsContainer.style.display="block",this.noResultsMessage.style.display="none",document.querySelectorAll(".pdb-id-link").forEach(w=>{w.addEventListener("click",E=>{E.preventDefault(),this.moleculeManager.showPDBDetailsModal(E.target.dataset.pdbId)})}),document.querySelectorAll(".view-structure-btn.rcsb-btn").forEach(w=>{w.addEventListener("click",E=>{window.open(`${Ke}/${E.target.dataset.pdbId}`,"_blank")})}),document.querySelectorAll(".view-structure-btn.pdbe-btn").forEach(w=>{w.addEventListener("click",E=>{window.open(`${Ze}/${E.target.dataset.pdbId.toLowerCase()}`,"_blank")})}),document.querySelectorAll(".add-ligand").forEach(w=>{w.addEventListener("click",E=>{const{ccdCode:b,pdbId:L,authSeqId:T,labelAsymId:j}=E.currentTarget.dataset;this.moleculeManager.addPdbInstance({code:b,pdbId:L,authSeqId:T,labelAsymId:j})?showNotification(`Adding molecule ${b}...`,"success"):showNotification(`Molecule ${b} already exists`,"info")})})}else this.noResultsMessage.textContent="No PDB entries found in this group.",this.noResultsMessage.style.display="block",this.resultsContainer.style.display="none"}}class Ca{constructor(){this.modal=document.getElementById("comparison-modal"),this.viewerContainer=document.getElementById("comparison-viewer"),this.title=document.getElementById("comparison-title");const s=document.getElementById("close-comparison-modal");s&&s.addEventListener("click",()=>this.close()),window.addEventListener("click",d=>{d.target===this.modal&&this.close()})}show(s,d){!s||!d||(this.title&&(this.title.textContent=`${s.code} vs ${d.code}`),this.viewerContainer&&(this.viewerContainer.innerHTML=""),this.modal&&(this.modal.style.display="block"),setTimeout(()=>{try{const h=$3Dmol.createViewer(this.viewerContainer,{backgroundColor:"white"}),f=h.addModel(s.sdf,"sdf"),v=h.addModel(d.sdf,"sdf");f.setStyle({},{stick:{colorscheme:"cyanCarbon"}}),v.setStyle({},{stick:{colorscheme:"magentaCarbon"}}),this._alignModels(f,v),h.zoomTo(),h.render()}catch(h){console.error("Error rendering comparison viewer:",h),this.viewerContainer&&(this.viewerContainer.innerHTML='<p style="text-align:center;padding:20px;">Render Error</p>')}},100))}_alignModels(s,d){if(!s||!d||!s.selectedAtoms||!d.selectedAtoms)return;const h=s.selectedAtoms({}),f=d.selectedAtoms({});if(!h.length||!f.length)return;const v=L=>{let T=0,j=0,R=0;for(const H of L)T+=H.x,j+=H.y,R+=H.z;return{x:T/L.length,y:j/L.length,z:R/L.length}},y=v(h),p=v(f),w=y.x-p.x,E=y.y-p.y,b=y.z-p.z;for(const L of f)L.x+=w,L.y+=E,L.z+=b}close(){this.modal&&(this.modal.style.display="none")}}function Sa(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}function $a(P){if(P.__esModule)return P;var s=P.default;if(typeof s=="function"){var d=function h(){return this instanceof h?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};d.prototype=s.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(P).forEach(function(h){var f=Object.getOwnPropertyDescriptor(P,h);Object.defineProperty(d,h,f.get?f:{enumerable:!0,get:function(){return P[h]}})}),d}var Dr={exports:{}};const Da={},Ma=Object.freeze(Object.defineProperty({__proto__:null,default:Da},Symbol.toStringTag,{value:"Module"})),$r=$a(Ma);(function(P,s){var d=(()=>{var f;var h=typeof document<"u"?(f=document.currentScript)==null?void 0:f.src:void 0;return async function(v={}){var br;var y,p=v,w=typeof window=="object",E=typeof WorkerGlobalScope<"u",b=typeof process=="object"&&((br=process.versions)==null?void 0:br.node)&&process.type!="renderer",L="./this.program";typeof __filename<"u"?h=__filename:E&&(h=self.location.href);var T="";function j(e){return p.locateFile?p.locateFile(e,T):T+e}var R,H;if(b){var z=$r;T=__dirname+"/",H=e=>{e=_e(e)?new URL(e):e;var t=z.readFileSync(e);return t},R=async(e,t=!0)=>{e=_e(e)?new URL(e):e;var r=z.readFileSync(e,t?void 0:"utf8");return r},process.argv.length>1&&(L=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(w||E){try{T=new URL(".",h).href}catch{}E&&(H=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),R=async e=>{if(_e(e))return new Promise((r,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{if(i.status==200||i.status==0&&i.response){r(i.response);return}n(i.status)},i.onerror=n,i.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var Q=console.log.bind(console),X=console.error.bind(console),ie,se=!1,_e=e=>e.startsWith("file://");function Lr(){var e=Et();e==0&&(e+=4),B[e>>>2>>>0]=34821223,B[e+4>>>2>>>0]=2310721022,B[0]=1668509029}function et(){if(!se){var e=Et();e==0&&(e+=4);var t=B[e>>>2>>>0],r=B[e+4>>>2>>>0];(t!=34821223||r!=2310721022)&&Le(`Stack overflow! Stack cookie has been overwritten at ${nt(e)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${nt(r)} ${nt(t)}`),B[0]!=1668509029&&Le("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var Be,xe,Ne,ee,re,De,be,N,B,Lt,At,ae,Tt,Pt=!1;function It(){var e=Ne.buffer;ee=new Int8Array(e),De=new Int16Array(e),re=new Uint8Array(e),be=new Uint16Array(e),N=new Int32Array(e),B=new Uint32Array(e),Lt=new Float32Array(e),At=new Float64Array(e),ae=new BigInt64Array(e),Tt=new BigUint64Array(e)}function Ar(){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)Or(p.preRun.shift());xt(Rt)}function Tr(){Pt=!0,et(),!p.noFSInit&&!l.initialized&&l.init(),fe._b(),l.ignorePermissions=!1}function Pr(){if(et(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;)Ur(p.postRun.shift());xt(Nt)}var pe=0,Me=null;function Bt(e){var t;pe++,(t=p.monitorRunDependencies)==null||t.call(p,pe)}function tt(e){var r;if(pe--,(r=p.monitorRunDependencies)==null||r.call(p,pe),pe==0&&Me){var t=Me;Me=null,t()}}function Le(e){var r;(r=p.onAbort)==null||r.call(p,e),e="Aborted("+e+")",X(e),se=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw xe==null||xe(t),t}var rt;function Ir(){return j("RDKit_minimal.wasm")}function Br(e){if(e==rt&&ie)return new Uint8Array(ie);if(H)return H(e);throw"both async and sync fetching of the wasm failed"}async function xr(e){if(!ie)try{var t=await R(e);return new Uint8Array(t)}catch{}return Br(e)}async function Nr(e,t){try{var r=await xr(e),n=await WebAssembly.instantiate(r,t);return n}catch(i){X(`failed to asynchronously prepare wasm: ${i}`),Le(i)}}async function Rr(e,t,r){if(!e&&typeof WebAssembly.instantiateStreaming=="function"&&!_e(t)&&!b)try{var n=fetch(t,{credentials:"same-origin"}),i=await WebAssembly.instantiateStreaming(n,r);return i}catch(o){X(`wasm streaming compile failed: ${o}`),X("falling back to ArrayBuffer instantiation")}return Nr(t,r)}function Fr(){return{a:Wi}}async function Hr(){function e(o,a){return fe=o.exports,fe=Os(fe),Ne=fe.Zb,It(),er=fe.ac,zi(fe),tt(),fe}Bt();function t(o){return e(o.instance)}var r=Fr();if(p.instantiateWasm)return new Promise((o,a)=>{p.instantiateWasm(r,(c,u)=>{o(e(c))})});rt??(rt=Ir());var n=await Rr(ie,rt,r),i=t(n);return i}var xt=e=>{for(;e.length>0;)e.shift()(p)},Nt=[],Ur=e=>Nt.push(e),Rt=[],Or=e=>Rt.push(e),nt=e=>"0x"+e.toString(16).padStart(8,"0"),S=e=>mr(e),$=()=>vr(),Re=[],Fe=0,jr=9007199254740992,Vr=-9007199254740992,He=e=>e<Vr||e>jr?NaN:Number(e);function zr(e){e>>>=0;var t=new it(e);return t.get_caught()||(t.set_caught(!0),Fe--),t.set_rethrown(!1),Re.push(t),yr(e),_r(e)}var le=0,Wr=()=>{C(0,0);var e=Re.pop();gr(e.excPtr),le=0};class it{constructor(t){this.excPtr=t,this.ptr=t-24}set_type(t){B[this.ptr+4>>>2>>>0]=t}get_type(){return B[this.ptr+4>>>2>>>0]}set_destructor(t){B[this.ptr+8>>>2>>>0]=t}get_destructor(){return B[this.ptr+8>>>2>>>0]}set_caught(t){t=t?1:0,ee[this.ptr+12>>>0]=t}get_caught(){return ee[this.ptr+12>>>0]!=0}set_rethrown(t){t=t?1:0,ee[this.ptr+13>>>0]=t}get_rethrown(){return ee[this.ptr+13>>>0]!=0}init(t,r){this.set_adjusted_ptr(0),this.set_type(t),this.set_destructor(r)}set_adjusted_ptr(t){B[this.ptr+16>>>2>>>0]=t}get_adjusted_ptr(){return B[this.ptr+16>>>2>>>0]}}var Ue=e=>hr(e),ot=e=>{var t=le;if(!t)return Ue(0),0;var r=new it(t);r.set_adjusted_ptr(t);var n=r.get_type();if(!n)return Ue(0),t;for(var i of e){if(i===0||i===n)break;var o=r.ptr+16;if(wr(i,n,o))return Ue(i),t}return Ue(n),t};function qr(){return ot([])}function Gr(e){return e>>>=0,ot([e])}function Yr(e,t){return e>>>=0,t>>>=0,ot([e,t])}var Jr=()=>{var e=Re.pop();e||Le("no exception to throw");var t=e.excPtr;throw e.get_rethrown()||(Re.push(e),e.set_rethrown(!0),e.set_caught(!1),Fe++),le=t,le};function Xr(e,t,r){e>>>=0,t>>>=0,r>>>=0;var n=new it(e);throw n.init(t,r),le=e,Fe++,le}var Kr=()=>Fe;function Zr(e){throw e>>>=0,le||(le=e),le}var Oe=()=>{var e=N[+Y.varargs>>>2>>>0];return Y.varargs+=4,e},Qr=Oe,U={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return t.exec(e).slice(1)},normalizeArray:(e,t)=>{for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];i==="."?e.splice(n,1):i===".."?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:e=>{var t=U.isAbs(e),r=e.slice(-1)==="/";return e=U.normalizeArray(e.split("/").filter(n=>!!n),!t).join("/"),!e&&!t&&(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=U.splitPath(e),r=t[0],n=t[1];return!r&&!n?".":(n&&(n=n.slice(0,-1)),r+n)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>U.normalize(e.join("/")),join2:(e,t)=>U.normalize(e+"/"+t)},en=()=>{if(b){var e=$r;return t=>e.randomFillSync(t)}return t=>crypto.getRandomValues(t)},Ft=e=>{(Ft=en())(e)},Ee={resolve:(...e)=>{for(var t="",r=!1,n=e.length-1;n>=-1&&!r;n--){var i=n>=0?e[n]:l.cwd();if(typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!i)return"";t=i+"/"+t,r=U.isAbs(i)}return t=U.normalizeArray(t.split("/").filter(o=>!!o),!r).join("/"),(r?"/":"")+t||"."},relative:(e,t)=>{e=Ee.resolve(e).slice(1),t=Ee.resolve(t).slice(1);function r(m){for(var g=0;g<m.length&&m[g]==="";g++);for(var _=m.length-1;_>=0&&m[_]==="";_--);return g>_?[]:m.slice(g,_-g+1)}for(var n=r(e.split("/")),i=r(t.split("/")),o=Math.min(n.length,i.length),a=o,c=0;c<o;c++)if(n[c]!==i[c]){a=c;break}for(var u=[],c=a;c<n.length;c++)u.push("..");return u=u.concat(i.slice(a)),u.join("/")}},Ht=typeof TextDecoder<"u"?new TextDecoder:void 0,ke=(e,t=0,r=NaN)=>{t>>>=0;for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.buffer&&Ht)return Ht.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(!(a&128)){o+=String.fromCharCode(a);continue}var c=e[t++]&63;if((a&224)==192){o+=String.fromCharCode((a&31)<<6|c);continue}var u=e[t++]&63;if((a&240)==224?a=(a&15)<<12|c<<6|u:a=(a&7)<<18|c<<12|u<<6|e[t++]&63,a<65536)o+=String.fromCharCode(a);else{var m=a-65536;o+=String.fromCharCode(55296|m>>10,56320|m&1023)}}return o},st=[],at=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t},Ut=(e,t,r,n)=>{if(r>>>=0,!(n>0))return 0;for(var i=r,o=r+n-1,a=0;a<e.length;++a){var c=e.codePointAt(a);if(c<=127){if(r>=o)break;t[r++>>>0]=c}else if(c<=2047){if(r+1>=o)break;t[r++>>>0]=192|c>>6,t[r++>>>0]=128|c&63}else if(c<=65535){if(r+2>=o)break;t[r++>>>0]=224|c>>12,t[r++>>>0]=128|c>>6&63,t[r++>>>0]=128|c&63}else{if(r+3>=o)break;t[r++>>>0]=240|c>>18,t[r++>>>0]=128|c>>12&63,t[r++>>>0]=128|c>>6&63,t[r++>>>0]=128|c&63,a++}}return t[r>>>0]=0,r-i},lt=(e,t,r)=>{var n=at(e)+1,i=new Array(n),o=Ut(e,i,0,i.length);return i.length=o,i},tn=()=>{if(!st.length){var e=null;if(b){var t=256,r=Buffer.alloc(t),n=0,i=process.stdin.fd;try{n=z.readSync(i,r,0,t)}catch(o){if(o.toString().includes("EOF"))n=0;else throw o}n>0&&(e=r.slice(0,n).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`));if(!e)return null;st=lt(e)}return st.shift()},me={ttys:[],init(){},shutdown(){},register(e,t){me.ttys[e]={input:[],output:[],ops:t},l.registerDevice(e,me.stream_ops)},stream_ops:{open(e){var t=me.ttys[e.node.rdev];if(!t)throw new l.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,r,n,i){if(!e.tty||!e.tty.ops.get_char)throw new l.ErrnoError(60);for(var o=0,a=0;a<n;a++){var c;try{c=e.tty.ops.get_char(e.tty)}catch{throw new l.ErrnoError(29)}if(c===void 0&&o===0)throw new l.ErrnoError(6);if(c==null)break;o++,t[r+a]=c}return o&&(e.node.atime=Date.now()),o},write(e,t,r,n,i){if(!e.tty||!e.tty.ops.put_char)throw new l.ErrnoError(60);try{for(var o=0;o<n;o++)e.tty.ops.put_char(e.tty,t[r+o])}catch{throw new l.ErrnoError(29)}return n&&(e.node.mtime=e.node.ctime=Date.now()),o}},default_tty_ops:{get_char(e){return tn()},put_char(e,t){t===null||t===10?(Q(ke(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){var t;((t=e.output)==null?void 0:t.length)>0&&(Q(ke(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,t,r){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,t){t===null||t===10?(X(ke(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){var t;((t=e.output)==null?void 0:t.length)>0&&(X(ke(e.output)),e.output=[])}}},rn=(e,t)=>re.fill(0,e,e+t),Ot=(e,t)=>Math.ceil(e/t)*t,jt=e=>{e=Ot(e,65536);var t=fr(65536,e);return t&&rn(t,e),t},I={ops_table:null,mount(e){return I.createNode(null,"/",16895,0)},createNode(e,t,r,n){if(l.isBlkdev(r)||l.isFIFO(r))throw new l.ErrnoError(63);I.ops_table||(I.ops_table={dir:{node:{getattr:I.node_ops.getattr,setattr:I.node_ops.setattr,lookup:I.node_ops.lookup,mknod:I.node_ops.mknod,rename:I.node_ops.rename,unlink:I.node_ops.unlink,rmdir:I.node_ops.rmdir,readdir:I.node_ops.readdir,symlink:I.node_ops.symlink},stream:{llseek:I.stream_ops.llseek}},file:{node:{getattr:I.node_ops.getattr,setattr:I.node_ops.setattr},stream:{llseek:I.stream_ops.llseek,read:I.stream_ops.read,write:I.stream_ops.write,mmap:I.stream_ops.mmap,msync:I.stream_ops.msync}},link:{node:{getattr:I.node_ops.getattr,setattr:I.node_ops.setattr,readlink:I.node_ops.readlink},stream:{}},chrdev:{node:{getattr:I.node_ops.getattr,setattr:I.node_ops.setattr},stream:l.chrdev_stream_ops}});var i=l.createNode(e,t,r,n);return l.isDir(i.mode)?(i.node_ops=I.ops_table.dir.node,i.stream_ops=I.ops_table.dir.stream,i.contents={}):l.isFile(i.mode)?(i.node_ops=I.ops_table.file.node,i.stream_ops=I.ops_table.file.stream,i.usedBytes=0,i.contents=null):l.isLink(i.mode)?(i.node_ops=I.ops_table.link.node,i.stream_ops=I.ops_table.link.stream):l.isChrdev(i.mode)&&(i.node_ops=I.ops_table.chrdev.node,i.stream_ops=I.ops_table.chrdev.stream),i.atime=i.mtime=i.ctime=Date.now(),e&&(e.contents[t]=i,e.atime=e.mtime=e.ctime=i.atime),i},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){var n=1024*1024;t=Math.max(t,r*(r<n?2:1.125)>>>0),r!=0&&(t=Math.max(t,256));var i=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(i.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(t==0)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=l.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,l.isDir(e.mode)?t.size=4096:l.isFile(e.mode)?t.size=e.usedBytes:l.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(const r of["mode","atime","mtime","ctime"])t[r]!=null&&(e[r]=t[r]);t.size!==void 0&&I.resizeFileStorage(e,t.size)},lookup(e,t){throw I.doesNotExistError},mknod(e,t,r,n){return I.createNode(e,t,r,n)},rename(e,t,r){var n;try{n=l.lookupNode(t,r)}catch{}if(n){if(l.isDir(e.mode))for(var i in n.contents)throw new l.ErrnoError(55);l.hashRemoveNode(n)}delete e.parent.contents[e.name],t.contents[r]=e,e.name=r,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var r=l.lookupNode(e,t);for(var n in r.contents)throw new l.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.contents)]},symlink(e,t,r){var n=I.createNode(e,t,41471,0);return n.link=r,n},readlink(e){if(!l.isLink(e.mode))throw new l.ErrnoError(28);return e.link}},stream_ops:{read(e,t,r,n,i){var o=e.node.contents;if(i>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-i,n);if(a>8&&o.subarray)t.set(o.subarray(i,i+a),r);else for(var c=0;c<a;c++)t[r+c]=o[i+c];return a},write(e,t,r,n,i,o){if(t.buffer===ee.buffer&&(o=!1),!n)return 0;var a=e.node;if(a.mtime=a.ctime=Date.now(),t.subarray&&(!a.contents||a.contents.subarray)){if(o)return a.contents=t.subarray(r,r+n),a.usedBytes=n,n;if(a.usedBytes===0&&i===0)return a.contents=t.slice(r,r+n),a.usedBytes=n,n;if(i+n<=a.usedBytes)return a.contents.set(t.subarray(r,r+n),i),n}if(I.expandFileStorage(a,i+n),a.contents.subarray&&t.subarray)a.contents.set(t.subarray(r,r+n),i);else for(var c=0;c<n;c++)a.contents[i+c]=t[r+c];return a.usedBytes=Math.max(a.usedBytes,i+n),n},llseek(e,t,r){var n=t;if(r===1?n+=e.position:r===2&&l.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new l.ErrnoError(28);return n},mmap(e,t,r,n,i){if(!l.isFile(e.node.mode))throw new l.ErrnoError(43);var o,a,c=e.node.contents;if(!(i&2)&&c&&c.buffer===ee.buffer)a=!1,o=c.byteOffset;else{if(a=!0,o=jt(t),!o)throw new l.ErrnoError(48);c&&((r>0||r+t<c.length)&&(c.subarray?c=c.subarray(r,r+t):c=Array.prototype.slice.call(c,r,r+t)),ee.set(c,o>>>0))}return{ptr:o,allocated:a}},msync(e,t,r,n,i){return I.stream_ops.write(e,t,0,n,r,!1),0}}},nn=async e=>{var t=await R(e);return new Uint8Array(t)},on=(...e)=>l.createDataFile(...e),Vt=[],sn=(e,t,r,n)=>{typeof Browser<"u"&&Browser.init();var i=!1;return Vt.forEach(o=>{i||o.canHandle(t)&&(o.handle(e,t,r,n),i=!0)}),i},an=(e,t,r,n,i,o,a,c,u,m)=>{var g=t?Ee.resolve(U.join2(e,t)):e;function _(M){function D(A){m==null||m(),c||on(e,t,A,n,i,u),o==null||o(),tt()}sn(M,g,D,()=>{a==null||a(),tt()})||D(M)}Bt(),typeof r=="string"?nn(r).then(_,a):_(r)},ln=e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},r=t[e];if(typeof r>"u")throw new Error(`Unknown file open mode: ${e}`);return r},ct=(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},l={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{constructor(e){oe(this,"name","ErrnoError");this.errno=e}},FSStream:class{constructor(){oe(this,"shared",{})}get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{constructor(e,t,r,n){oe(this,"node_ops",{});oe(this,"stream_ops",{});oe(this,"readMode",365);oe(this,"writeMode",146);oe(this,"mounted",null);e||(e=this),this.parent=e,this.mount=e.mount,this.id=l.nextInode++,this.name=t,this.mode=r,this.rdev=n,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return l.isDir(this.mode)}get isDevice(){return l.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new l.ErrnoError(44);t.follow_mount??(t.follow_mount=!0),U.isAbs(e)||(e=l.cwd()+"/"+e);e:for(var r=0;r<40;r++){for(var n=e.split("/").filter(m=>!!m),i=l.root,o="/",a=0;a<n.length;a++){var c=a===n.length-1;if(c&&t.parent)break;if(n[a]!=="."){if(n[a]===".."){if(o=U.dirname(o),l.isRoot(i)){e=o+"/"+n.slice(a+1).join("/");continue e}else i=i.parent;continue}o=U.join2(o,n[a]);try{i=l.lookupNode(i,n[a])}catch(m){if((m==null?void 0:m.errno)===44&&c&&t.noent_okay)return{path:o};throw m}if(l.isMountpoint(i)&&(!c||t.follow_mount)&&(i=i.mounted.root),l.isLink(i.mode)&&(!c||t.follow)){if(!i.node_ops.readlink)throw new l.ErrnoError(52);var u=i.node_ops.readlink(i);U.isAbs(u)||(u=U.dirname(o)+"/"+u),e=u+"/"+n.slice(a+1).join("/");continue e}}}return{path:o,node:i}}throw new l.ErrnoError(32)},getPath(e){for(var t;;){if(l.isRoot(e)){var r=e.mount.mountpoint;return t?r[r.length-1]!=="/"?`${r}/${t}`:r+t:r}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%l.nameTable.length},hashAddNode(e){var t=l.hashName(e.parent.id,e.name);e.name_next=l.nameTable[t],l.nameTable[t]=e},hashRemoveNode(e){var t=l.hashName(e.parent.id,e.name);if(l.nameTable[t]===e)l.nameTable[t]=e.name_next;else for(var r=l.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode(e,t){var r=l.mayLookup(e);if(r)throw new l.ErrnoError(r);for(var n=l.hashName(e.id,t),i=l.nameTable[n];i;i=i.name_next){var o=i.name;if(i.parent.id===e.id&&o===t)return i}return l.lookup(e,t)},createNode(e,t,r,n){var i=new l.FSNode(e,t,r,n);return l.hashAddNode(i),i},destroyNode(e){l.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t},nodePermissions(e,t){return l.ignorePermissions?0:t.includes("r")&&!(e.mode&292)||t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!l.isDir(e.mode))return 54;var t=l.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate(e,t){if(!l.isDir(e.mode))return 54;try{var r=l.lookupNode(e,t);return 20}catch{}return l.nodePermissions(e,"wx")},mayDelete(e,t,r){var n;try{n=l.lookupNode(e,t)}catch(o){return o.errno}var i=l.nodePermissions(e,"wx");if(i)return i;if(r){if(!l.isDir(n.mode))return 54;if(l.isRoot(n)||l.getPath(n)===l.cwd())return 10}else if(l.isDir(n.mode))return 31;return 0},mayOpen(e,t){return e?l.isLink(e.mode)?32:l.isDir(e.mode)&&(l.flagsToPermissionString(t)!=="r"||t&576)?31:l.nodePermissions(e,l.flagsToPermissionString(t)):44},checkOpExists(e,t){if(!e)throw new l.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=l.MAX_OPEN_FDS;e++)if(!l.streams[e])return e;throw new l.ErrnoError(33)},getStreamChecked(e){var t=l.getStream(e);if(!t)throw new l.ErrnoError(8);return t},getStream:e=>l.streams[e],createStream(e,t=-1){return e=Object.assign(new l.FSStream,e),t==-1&&(t=l.nextfd()),e.fd=t,l.streams[t]=e,e},closeStream(e){l.streams[e]=null},dupStream(e,t=-1){var n,i;var r=l.createStream(e,t);return(i=(n=r.stream_ops)==null?void 0:n.dup)==null||i.call(n,r),r},doSetAttr(e,t,r){var n=e==null?void 0:e.stream_ops.setattr,i=n?e:t;n??(n=t.node_ops.setattr),l.checkOpExists(n,63),n(i,r)},chrdev_stream_ops:{open(e){var r,n;var t=l.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,(n=(r=e.stream_ops).open)==null||n.call(r,e)},llseek(){throw new l.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,t)=>e<<8|t,registerDevice(e,t){l.devices[e]={stream_ops:t}},getDevice:e=>l.devices[e],getMounts(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push(...n.mounts)}return t},syncfs(e,t){typeof e=="function"&&(t=e,e=!1),l.syncFSRequests++,l.syncFSRequests>1&&X(`warning: ${l.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var r=l.getMounts(l.root.mount),n=0;function i(a){return l.syncFSRequests--,t(a)}function o(a){if(a)return o.errored?void 0:(o.errored=!0,i(a));++n>=r.length&&i(null)}r.forEach(a=>{if(!a.type.syncfs)return o(null);a.type.syncfs(a,e,o)})},mount(e,t,r){var n=r==="/",i=!r,o;if(n&&l.root)throw new l.ErrnoError(10);if(!n&&!i){var a=l.lookupPath(r,{follow_mount:!1});if(r=a.path,o=a.node,l.isMountpoint(o))throw new l.ErrnoError(10);if(!l.isDir(o.mode))throw new l.ErrnoError(54)}var c={type:e,opts:t,mountpoint:r,mounts:[]},u=e.mount(c);return u.mount=c,c.root=u,n?l.root=u:o&&(o.mounted=c,o.mount&&o.mount.mounts.push(c)),u},unmount(e){var t=l.lookupPath(e,{follow_mount:!1});if(!l.isMountpoint(t.node))throw new l.ErrnoError(28);var r=t.node,n=r.mounted,i=l.getMounts(n);Object.keys(l.nameTable).forEach(a=>{for(var c=l.nameTable[a];c;){var u=c.name_next;i.includes(c.mount)&&l.destroyNode(c),c=u}}),r.mounted=null;var o=r.mount.mounts.indexOf(n);r.mount.mounts.splice(o,1)},lookup(e,t){return e.node_ops.lookup(e,t)},mknod(e,t,r){var n=l.lookupPath(e,{parent:!0}),i=n.node,o=U.basename(e);if(!o)throw new l.ErrnoError(28);if(o==="."||o==="..")throw new l.ErrnoError(20);var a=l.mayCreate(i,o);if(a)throw new l.ErrnoError(a);if(!i.node_ops.mknod)throw new l.ErrnoError(63);return i.node_ops.mknod(i,o,t,r)},statfs(e){return l.statfsNode(l.lookupPath(e,{follow:!0}).node)},statfsStream(e){return l.statfsNode(e.node)},statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:l.nextInode,ffree:l.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create(e,t=438){return t&=4095,t|=32768,l.mknod(e,t,0)},mkdir(e,t=511){return t&=1023,t|=16384,l.mknod(e,t,0)},mkdirTree(e,t){var r=e.split("/"),n="";for(var i of r)if(i){(n||U.isAbs(e))&&(n+="/"),n+=i;try{l.mkdir(n,t)}catch(o){if(o.errno!=20)throw o}}},mkdev(e,t,r){return typeof r>"u"&&(r=t,t=438),t|=8192,l.mknod(e,t,r)},symlink(e,t){if(!Ee.resolve(e))throw new l.ErrnoError(44);var r=l.lookupPath(t,{parent:!0}),n=r.node;if(!n)throw new l.ErrnoError(44);var i=U.basename(t),o=l.mayCreate(n,i);if(o)throw new l.ErrnoError(o);if(!n.node_ops.symlink)throw new l.ErrnoError(63);return n.node_ops.symlink(n,i,e)},rename(e,t){var r=U.dirname(e),n=U.dirname(t),i=U.basename(e),o=U.basename(t),a,c,u;if(a=l.lookupPath(e,{parent:!0}),c=a.node,a=l.lookupPath(t,{parent:!0}),u=a.node,!c||!u)throw new l.ErrnoError(44);if(c.mount!==u.mount)throw new l.ErrnoError(75);var m=l.lookupNode(c,i),g=Ee.relative(e,n);if(g.charAt(0)!==".")throw new l.ErrnoError(28);if(g=Ee.relative(t,r),g.charAt(0)!==".")throw new l.ErrnoError(55);var _;try{_=l.lookupNode(u,o)}catch{}if(m!==_){var M=l.isDir(m.mode),D=l.mayDelete(c,i,M);if(D)throw new l.ErrnoError(D);if(D=_?l.mayDelete(u,o,M):l.mayCreate(u,o),D)throw new l.ErrnoError(D);if(!c.node_ops.rename)throw new l.ErrnoError(63);if(l.isMountpoint(m)||_&&l.isMountpoint(_))throw new l.ErrnoError(10);if(u!==c&&(D=l.nodePermissions(c,"w"),D))throw new l.ErrnoError(D);l.hashRemoveNode(m);try{c.node_ops.rename(m,u,o),m.parent=u}catch(A){throw A}finally{l.hashAddNode(m)}}},rmdir(e){var t=l.lookupPath(e,{parent:!0}),r=t.node,n=U.basename(e),i=l.lookupNode(r,n),o=l.mayDelete(r,n,!0);if(o)throw new l.ErrnoError(o);if(!r.node_ops.rmdir)throw new l.ErrnoError(63);if(l.isMountpoint(i))throw new l.ErrnoError(10);r.node_ops.rmdir(r,n),l.destroyNode(i)},readdir(e){var t=l.lookupPath(e,{follow:!0}),r=t.node,n=l.checkOpExists(r.node_ops.readdir,54);return n(r)},unlink(e){var t=l.lookupPath(e,{parent:!0}),r=t.node;if(!r)throw new l.ErrnoError(44);var n=U.basename(e),i=l.lookupNode(r,n),o=l.mayDelete(r,n,!1);if(o)throw new l.ErrnoError(o);if(!r.node_ops.unlink)throw new l.ErrnoError(63);if(l.isMountpoint(i))throw new l.ErrnoError(10);r.node_ops.unlink(r,n),l.destroyNode(i)},readlink(e){var t=l.lookupPath(e),r=t.node;if(!r)throw new l.ErrnoError(44);if(!r.node_ops.readlink)throw new l.ErrnoError(28);return r.node_ops.readlink(r)},stat(e,t){var r=l.lookupPath(e,{follow:!t}),n=r.node,i=l.checkOpExists(n.node_ops.getattr,63);return i(n)},fstat(e){var t=l.getStreamChecked(e),r=t.node,n=t.stream_ops.getattr,i=n?t:r;return n??(n=r.node_ops.getattr),l.checkOpExists(n,63),n(i)},lstat(e){return l.stat(e,!0)},doChmod(e,t,r,n){l.doSetAttr(e,t,{mode:r&4095|t.mode&-4096,ctime:Date.now(),dontFollow:n})},chmod(e,t,r){var n;if(typeof e=="string"){var i=l.lookupPath(e,{follow:!r});n=i.node}else n=e;l.doChmod(null,n,t,r)},lchmod(e,t){l.chmod(e,t,!0)},fchmod(e,t){var r=l.getStreamChecked(e);l.doChmod(r,r.node,t,!1)},doChown(e,t,r){l.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:r})},chown(e,t,r,n){var i;if(typeof e=="string"){var o=l.lookupPath(e,{follow:!n});i=o.node}else i=e;l.doChown(null,i,n)},lchown(e,t,r){l.chown(e,t,r,!0)},fchown(e,t,r){var n=l.getStreamChecked(e);l.doChown(n,n.node,!1)},doTruncate(e,t,r){if(l.isDir(t.mode))throw new l.ErrnoError(31);if(!l.isFile(t.mode))throw new l.ErrnoError(28);var n=l.nodePermissions(t,"w");if(n)throw new l.ErrnoError(n);l.doSetAttr(e,t,{size:r,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new l.ErrnoError(28);var r;if(typeof e=="string"){var n=l.lookupPath(e,{follow:!0});r=n.node}else r=e;l.doTruncate(null,r,t)},ftruncate(e,t){var r=l.getStreamChecked(e);if(t<0||!(r.flags&2097155))throw new l.ErrnoError(28);l.doTruncate(r,r.node,t)},utime(e,t,r){var n=l.lookupPath(e,{follow:!0}),i=n.node,o=l.checkOpExists(i.node_ops.setattr,63);o(i,{atime:t,mtime:r})},open(e,t,r=438){if(e==="")throw new l.ErrnoError(44);t=typeof t=="string"?ln(t):t,t&64?r=r&4095|32768:r=0;var n,i;if(typeof e=="object")n=e;else{i=e.endsWith("/");var o=l.lookupPath(e,{follow:!(t&131072),noent_okay:!0});n=o.node,e=o.path}var a=!1;if(t&64)if(n){if(t&128)throw new l.ErrnoError(20)}else{if(i)throw new l.ErrnoError(31);n=l.mknod(e,r|511,0),a=!0}if(!n)throw new l.ErrnoError(44);if(l.isChrdev(n.mode)&&(t&=-513),t&65536&&!l.isDir(n.mode))throw new l.ErrnoError(54);if(!a){var c=l.mayOpen(n,t);if(c)throw new l.ErrnoError(c)}t&512&&!a&&l.truncate(n,0),t&=-131713;var u=l.createStream({node:n,path:l.getPath(n),flags:t,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),a&&l.chmod(n,r&511),p.logReadFiles&&!(t&1)&&(e in l.readFiles||(l.readFiles[e]=1)),u},close(e){if(l.isClosed(e))throw new l.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{l.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,t,r){if(l.isClosed(e))throw new l.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new l.ErrnoError(70);if(r!=0&&r!=1&&r!=2)throw new l.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read(e,t,r,n,i){if(n<0||i<0)throw new l.ErrnoError(28);if(l.isClosed(e))throw new l.ErrnoError(8);if((e.flags&2097155)===1)throw new l.ErrnoError(8);if(l.isDir(e.node.mode))throw new l.ErrnoError(31);if(!e.stream_ops.read)throw new l.ErrnoError(28);var o=typeof i<"u";if(!o)i=e.position;else if(!e.seekable)throw new l.ErrnoError(70);var a=e.stream_ops.read(e,t,r,n,i);return o||(e.position+=a),a},write(e,t,r,n,i,o){if(n<0||i<0)throw new l.ErrnoError(28);if(l.isClosed(e))throw new l.ErrnoError(8);if(!(e.flags&2097155))throw new l.ErrnoError(8);if(l.isDir(e.node.mode))throw new l.ErrnoError(31);if(!e.stream_ops.write)throw new l.ErrnoError(28);e.seekable&&e.flags&1024&&l.llseek(e,0,2);var a=typeof i<"u";if(!a)i=e.position;else if(!e.seekable)throw new l.ErrnoError(70);var c=e.stream_ops.write(e,t,r,n,i,o);return a||(e.position+=c),c},mmap(e,t,r,n,i){if(n&2&&!(i&2)&&(e.flags&2097155)!==2)throw new l.ErrnoError(2);if((e.flags&2097155)===1)throw new l.ErrnoError(2);if(!e.stream_ops.mmap)throw new l.ErrnoError(43);if(!t)throw new l.ErrnoError(28);return e.stream_ops.mmap(e,t,r,n,i)},msync(e,t,r,n,i){return e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,i):0},ioctl(e,t,r){if(!e.stream_ops.ioctl)throw new l.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile(e,t={}){if(t.flags=t.flags||0,t.encoding=t.encoding||"binary",t.encoding!=="utf8"&&t.encoding!=="binary")throw new Error(`Invalid encoding type "${t.encoding}"`);var r=l.open(e,t.flags),n=l.stat(e),i=n.size,o=new Uint8Array(i);return l.read(r,o,0,i,0),t.encoding==="utf8"&&(o=ke(o)),l.close(r),o},writeFile(e,t,r={}){r.flags=r.flags||577;var n=l.open(e,r.flags,r.mode);if(typeof t=="string"&&(t=new Uint8Array(lt(t))),ArrayBuffer.isView(t))l.write(n,t,0,t.byteLength,void 0,r.canOwn);else throw new Error("Unsupported data type");l.close(n)},cwd:()=>l.currentPath,chdir(e){var t=l.lookupPath(e,{follow:!0});if(t.node===null)throw new l.ErrnoError(44);if(!l.isDir(t.node.mode))throw new l.ErrnoError(54);var r=l.nodePermissions(t.node,"x");if(r)throw new l.ErrnoError(r);l.currentPath=t.path},createDefaultDirectories(){l.mkdir("/tmp"),l.mkdir("/home"),l.mkdir("/home/web_user")},createDefaultDevices(){l.mkdir("/dev"),l.registerDevice(l.makedev(1,3),{read:()=>0,write:(n,i,o,a,c)=>a,llseek:()=>0}),l.mkdev("/dev/null",l.makedev(1,3)),me.register(l.makedev(5,0),me.default_tty_ops),me.register(l.makedev(6,0),me.default_tty1_ops),l.mkdev("/dev/tty",l.makedev(5,0)),l.mkdev("/dev/tty1",l.makedev(6,0));var e=new Uint8Array(1024),t=0,r=()=>(t===0&&(Ft(e),t=e.byteLength),e[--t]);l.createDevice("/dev","random",r),l.createDevice("/dev","urandom",r),l.mkdir("/dev/shm"),l.mkdir("/dev/shm/tmp")},createSpecialDirectories(){l.mkdir("/proc");var e=l.mkdir("/proc/self");l.mkdir("/proc/self/fd"),l.mount({mount(){var t=l.createNode(e,"fd",16895,73);return t.stream_ops={llseek:I.stream_ops.llseek},t.node_ops={lookup(r,n){var i=+n,o=l.getStreamChecked(i),a={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>o.path},id:i+1};return a.parent=a,a},readdir(){return Array.from(l.streams.entries()).filter(([r,n])=>n).map(([r,n])=>r.toString())}},t}},{},"/proc/self/fd")},createStandardStreams(e,t,r){e?l.createDevice("/dev","stdin",e):l.symlink("/dev/tty","/dev/stdin"),t?l.createDevice("/dev","stdout",null,t):l.symlink("/dev/tty","/dev/stdout"),r?l.createDevice("/dev","stderr",null,r):l.symlink("/dev/tty1","/dev/stderr"),l.open("/dev/stdin",0),l.open("/dev/stdout",1),l.open("/dev/stderr",1)},staticInit(){l.nameTable=new Array(4096),l.mount(I,{},"/"),l.createDefaultDirectories(),l.createDefaultDevices(),l.createSpecialDirectories(),l.filesystems={MEMFS:I}},init(e,t,r){l.initialized=!0,e??(e=p.stdin),t??(t=p.stdout),r??(r=p.stderr),l.createStandardStreams(e,t,r)},quit(){l.initialized=!1;for(var e of l.streams)e&&l.close(e)},findObject(e,t){var r=l.analyzePath(e,t);return r.exists?r.object:null},analyzePath(e,t){try{var r=l.lookupPath(e,{follow:!t});e=r.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=l.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=r.path,n.parentObject=r.node,n.name=U.basename(e),r=l.lookupPath(e,{follow:!t}),n.exists=!0,n.path=r.path,n.object=r.node,n.name=r.node.name,n.isRoot=r.path==="/"}catch(i){n.error=i.errno}return n},createPath(e,t,r,n){e=typeof e=="string"?e:l.getPath(e);for(var i=t.split("/").reverse();i.length;){var o=i.pop();if(o){var a=U.join2(e,o);try{l.mkdir(a)}catch(c){if(c.errno!=20)throw c}e=a}}return a},createFile(e,t,r,n,i){var o=U.join2(typeof e=="string"?e:l.getPath(e),t),a=ct(n,i);return l.create(o,a)},createDataFile(e,t,r,n,i,o){var a=t;e&&(e=typeof e=="string"?e:l.getPath(e),a=t?U.join2(e,t):e);var c=ct(n,i),u=l.create(a,c);if(r){if(typeof r=="string"){for(var m=new Array(r.length),g=0,_=r.length;g<_;++g)m[g]=r.charCodeAt(g);r=m}l.chmod(u,c|146);var M=l.open(u,577);l.write(M,r,0,r.length,0,o),l.close(M),l.chmod(u,c)}},createDevice(e,t,r,n){var c;var i=U.join2(typeof e=="string"?e:l.getPath(e),t),o=ct(!!r,!!n);(c=l.createDevice).major??(c.major=64);var a=l.makedev(l.createDevice.major++,0);return l.registerDevice(a,{open(u){u.seekable=!1},close(u){var m;(m=n==null?void 0:n.buffer)!=null&&m.length&&n(10)},read(u,m,g,_,M){for(var D=0,A=0;A<_;A++){var x;try{x=r()}catch{throw new l.ErrnoError(29)}if(x===void 0&&D===0)throw new l.ErrnoError(6);if(x==null)break;D++,m[g+A]=x}return D&&(u.node.atime=Date.now()),D},write(u,m,g,_,M){for(var D=0;D<_;D++)try{n(m[g+D])}catch{throw new l.ErrnoError(29)}return _&&(u.node.mtime=u.node.ctime=Date.now()),D}}),l.mkdev(i,o,a)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{e.contents=H(e.url),e.usedBytes=e.contents.length}catch{throw new l.ErrnoError(29)}},createLazyFile(e,t,r,n,i){class o{constructor(){oe(this,"lengthKnown",!1);oe(this,"chunks",[])}get(D){if(!(D>this.length-1||D<0)){var A=D%this.chunkSize,x=D/this.chunkSize|0;return this.getter(x)[A]}}setDataGetter(D){this.getter=D}cacheLength(){var D=new XMLHttpRequest;if(D.open("HEAD",r,!1),D.send(null),!(D.status>=200&&D.status<300||D.status===304))throw new Error("Couldn't load "+r+". Status: "+D.status);var A=Number(D.getResponseHeader("Content-length")),x,V=(x=D.getResponseHeader("Accept-Ranges"))&&x==="bytes",O=(x=D.getResponseHeader("Content-Encoding"))&&x==="gzip",J=1024*1024;V||(J=A);var W=(te,de)=>{if(te>de)throw new Error("invalid range ("+te+", "+de+") or no bytes requested!");if(de>A-1)throw new Error("only "+A+" bytes available! programmer error!");var G=new XMLHttpRequest;if(G.open("GET",r,!1),A!==J&&G.setRequestHeader("Range","bytes="+te+"-"+de),G.responseType="arraybuffer",G.overrideMimeType&&G.overrideMimeType("text/plain; charset=x-user-defined"),G.send(null),!(G.status>=200&&G.status<300||G.status===304))throw new Error("Couldn't load "+r+". Status: "+G.status);return G.response!==void 0?new Uint8Array(G.response||[]):lt(G.responseText||"")},we=this;we.setDataGetter(te=>{var de=te*J,G=(te+1)*J-1;if(G=Math.min(G,A-1),typeof we.chunks[te]>"u"&&(we.chunks[te]=W(de,G)),typeof we.chunks[te]>"u")throw new Error("doXHR failed!");return we.chunks[te]}),(O||!A)&&(J=A=1,A=this.getter(0).length,J=A,Q("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=A,this._chunkSize=J,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!E)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new o,c={isDevice:!1,contents:a}}else var c={isDevice:!1,url:r};var u=l.createFile(e,t,c,n,i);c.contents?u.contents=c.contents:c.url&&(u.contents=null,u.url=c.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var m={},g=Object.keys(u.stream_ops);g.forEach(M=>{var D=u.stream_ops[M];m[M]=(...A)=>(l.forceLoadFile(u),D(...A))});function _(M,D,A,x,V){var O=M.node.contents;if(V>=O.length)return 0;var J=Math.min(O.length-V,x);if(O.slice)for(var W=0;W<J;W++)D[A+W]=O[V+W];else for(var W=0;W<J;W++)D[A+W]=O.get(V+W);return J}return m.read=(M,D,A,x,V)=>(l.forceLoadFile(u),_(M,D,A,x,V)),m.mmap=(M,D,A,x,V)=>{l.forceLoadFile(u);var O=jt(D);if(!O)throw new l.ErrnoError(48);return _(M,ee,O,D,A),{ptr:O,allocated:!0}},u.stream_ops=m,u}},zt=(e,t)=>(e>>>=0,e?ke(re,e,t):""),Y={DEFAULT_POLLMASK:5,calculateAt(e,t,r){if(U.isAbs(t))return t;var n;if(e===-100)n=l.cwd();else{var i=Y.getStreamFromFD(e);n=i.path}if(t.length==0){if(!r)throw new l.ErrnoError(44);return n}return n+"/"+t},writeStat(e,t){N[e>>>2>>>0]=t.dev,N[e+4>>>2>>>0]=t.mode,B[e+8>>>2>>>0]=t.nlink,N[e+12>>>2>>>0]=t.uid,N[e+16>>>2>>>0]=t.gid,N[e+20>>>2>>>0]=t.rdev,ae[e+24>>>3>>>0]=BigInt(t.size),N[e+32>>>2>>>0]=4096,N[e+36>>>2>>>0]=t.blocks;var r=t.atime.getTime(),n=t.mtime.getTime(),i=t.ctime.getTime();return ae[e+40>>>3>>>0]=BigInt(Math.floor(r/1e3)),B[e+48>>>2>>>0]=r%1e3*1e3*1e3,ae[e+56>>>3>>>0]=BigInt(Math.floor(n/1e3)),B[e+64>>>2>>>0]=n%1e3*1e3*1e3,ae[e+72>>>3>>>0]=BigInt(Math.floor(i/1e3)),B[e+80>>>2>>>0]=i%1e3*1e3*1e3,ae[e+88>>>3>>>0]=BigInt(t.ino),0},writeStatFs(e,t){N[e+4>>>2>>>0]=t.bsize,N[e+40>>>2>>>0]=t.bsize,N[e+8>>>2>>>0]=t.blocks,N[e+12>>>2>>>0]=t.bfree,N[e+16>>>2>>>0]=t.bavail,N[e+20>>>2>>>0]=t.files,N[e+24>>>2>>>0]=t.ffree,N[e+28>>>2>>>0]=t.fsid,N[e+44>>>2>>>0]=t.flags,N[e+36>>>2>>>0]=t.namelen},doMsync(e,t,r,n,i){if(!l.isFile(t.node.mode))throw new l.ErrnoError(43);if(n&2)return 0;var o=re.slice(e,e+r);l.msync(t,o,i,r,n)},getStreamFromFD(e){var t=l.getStreamChecked(e);return t},varargs:void 0,getStr(e){var t=zt(e);return t}};function cn(e,t,r){r>>>=0,Y.varargs=r;try{var n=Y.getStreamFromFD(e);switch(t){case 0:{var i=Oe();if(i<0)return-28;for(;l.streams[i];)i++;var o;return o=l.dupStream(n,i),o.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var i=Oe();return n.flags|=i,0}case 12:{var i=Qr(),a=0;return De[i+a>>>1>>>0]=2,0}case 13:case 14:return 0}return-28}catch(c){if(typeof l>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function dn(e,t){t>>>=0;try{return Y.writeStat(t,l.fstat(e))}catch(r){if(typeof l>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function un(e,t,r,n){t>>>=0,r>>>=0;try{t=Y.getStr(t);var i=n&256,o=n&4096;return n=n&-6401,t=Y.calculateAt(e,t,o),Y.writeStat(r,i?l.lstat(t):l.stat(t))}catch(a){if(typeof l>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function fn(e,t,r,n){t>>>=0,n>>>=0,Y.varargs=n;try{t=Y.getStr(t),t=Y.calculateAt(e,t);var i=n?Oe():0;return l.open(t,r,i).fd}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var hn=()=>Le(""),Z=e=>{e>>>=0;for(var t="";;){var r=re[e++>>>0];if(!r)return t;t+=String.fromCharCode(r)}},Ce={},ve={},je={},Ae=class extends Error{constructor(t){super(t),this.name="BindingError"}},F=e=>{throw new Ae(e)};function pn(e,t,r={}){var n=t.name;if(e||F(`type "${n}" must have a positive integer typeid pointer`),ve.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;F(`Cannot register type '${n}' twice`)}if(ve[e]=t,delete je[e],Ce.hasOwnProperty(e)){var i=Ce[e];delete Ce[e],i.forEach(o=>o())}}function ne(e,t,r={}){return pn(e,t,r)}var Wt=(e,t,r)=>{switch(t){case 1:return r?n=>ee[n>>>0]:n=>re[n>>>0];case 2:return r?n=>De[n>>>1>>>0]:n=>be[n>>>1>>>0];case 4:return r?n=>N[n>>>2>>>0]:n=>B[n>>>2>>>0];case 8:return r?n=>ae[n>>>3>>>0]:n=>Tt[n>>>3>>>0];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}},mn=function(e,t,r,n,i){e>>>=0,t>>>=0,r>>>=0,t=Z(t);const o=n===0n;let a=c=>c;if(o){const c=r*8;a=u=>BigInt.asUintN(c,u),i=a(i)}ne(e,{name:t,fromWireType:a,toWireType:(c,u)=>(typeof u=="number"&&(u=BigInt(u)),u),argPackAdvance:ce,readValueFromPointer:Wt(t,r,!o),destructorFunction:null})},ce=8;function vn(e,t,r,n){e>>>=0,t>>>=0,t=Z(t),ne(e,{name:t,fromWireType:function(i){return!!i},toWireType:function(i,o){return o?r:n},argPackAdvance:ce,readValueFromPointer:function(i){return this.fromWireType(re[i>>>0])},destructorFunction:null})}var gn=e=>({count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}),dt=e=>{function t(r){return r.$$.ptrType.registeredClass.name}F(t(e)+" instance already deleted")},ut=!1,qt=e=>{},yn=e=>{e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)},Gt=e=>{e.count.value-=1;var t=e.count.value===0;t&&yn(e)},Te=e=>typeof FinalizationRegistry>"u"?(Te=t=>t,e):(ut=new FinalizationRegistry(t=>{Gt(t.$$)}),Te=t=>{var r=t.$$,n=!!r.smartPtr;if(n){var i={$$:r};ut.register(t,i,t)}return t},qt=t=>ut.unregister(t),Te(e)),wn=()=>{let e=Ve.prototype;Object.assign(e,{isAliasOf(r){if(!(this instanceof Ve)||!(r instanceof Ve))return!1;var n=this.$$.ptrType.registeredClass,i=this.$$.ptr;r.$$=r.$$;for(var o=r.$$.ptrType.registeredClass,a=r.$$.ptr;n.baseClass;)i=n.upcast(i),n=n.baseClass;for(;o.baseClass;)a=o.upcast(a),o=o.baseClass;return n===o&&i===a},clone(){if(this.$$.ptr||dt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var r=Te(Object.create(Object.getPrototypeOf(this),{$$:{value:gn(this.$$)}}));return r.$$.count.value+=1,r.$$.deleteScheduled=!1,r},delete(){this.$$.ptr||dt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&F("Object already scheduled for deletion"),qt(this),Gt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||dt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&F("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}});const t=Symbol.dispose;t&&(e[t]=e.delete)};function Ve(){}var ft=(e,t)=>Object.defineProperty(t,"name",{value:e}),Yt={},Jt=(e,t,r)=>{if(e[t].overloadTable===void 0){var n=e[t];e[t]=function(...i){return e[t].overloadTable.hasOwnProperty(i.length)||F(`Function '${r}' called with an invalid number of arguments (${i.length}) - expects one of (${e[t].overloadTable})!`),e[t].overloadTable[i.length].apply(this,i)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}},Xt=(e,t,r)=>{p.hasOwnProperty(e)?((r===void 0||p[e].overloadTable!==void 0&&p[e].overloadTable[r]!==void 0)&&F(`Cannot register public name '${e}' twice`),Jt(p,e,e),p[e].overloadTable.hasOwnProperty(r)&&F(`Cannot register multiple overloads of a function with the same number of arguments (${r})!`),p[e].overloadTable[r]=t):(p[e]=t,p[e].argCount=r)},_n=48,bn=57,En=e=>{e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return t>=_n&&t<=bn?`_${e}`:e};function kn(e,t,r,n,i,o,a,c){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=i,this.getActualType=o,this.upcast=a,this.downcast=c,this.pureVirtualFunctions=[]}var ht=(e,t,r)=>{for(;t!==r;)t.upcast||F(`Expected null or instance of ${r.name}, got an instance of ${t.name}`),e=t.upcast(e),t=t.baseClass;return e},pt=e=>{if(e===null)return"null";var t=typeof e;return t==="object"||t==="array"||t==="function"?e.toString():""+e};function Cn(e,t){if(t===null)return this.isReference&&F(`null is not a valid ${this.name}`),0;t.$$||F(`Cannot pass "${pt(t)}" as a ${this.name}`),t.$$.ptr||F(`Cannot pass deleted object as a pointer of type ${this.name}`);var r=t.$$.ptrType.registeredClass,n=ht(t.$$.ptr,r,this.registeredClass);return n}function Sn(e,t){var r;if(t===null)return this.isReference&&F(`null is not a valid ${this.name}`),this.isSmartPointer?(r=this.rawConstructor(),e!==null&&e.push(this.rawDestructor,r),r):0;(!t||!t.$$)&&F(`Cannot pass "${pt(t)}" as a ${this.name}`),t.$$.ptr||F(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&t.$$.ptrType.isConst&&F(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);var n=t.$$.ptrType.registeredClass;if(r=ht(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(t.$$.smartPtr===void 0&&F("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:F(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var i=t.clone();r=this.rawShare(r,q.toHandle(()=>i.delete())),e!==null&&e.push(this.rawDestructor,r)}break;default:F("Unsupporting sharing policy")}return r}function $n(e,t){if(t===null)return this.isReference&&F(`null is not a valid ${this.name}`),0;t.$$||F(`Cannot pass "${pt(t)}" as a ${this.name}`),t.$$.ptr||F(`Cannot pass deleted object as a pointer of type ${this.name}`),t.$$.ptrType.isConst&&F(`Cannot convert argument of type ${t.$$.ptrType.name} to parameter type ${this.name}`);var r=t.$$.ptrType.registeredClass,n=ht(t.$$.ptr,r,this.registeredClass);return n}function ze(e){return this.fromWireType(B[e>>>2>>>0])}var Kt=(e,t,r)=>{if(t===r)return e;if(r.baseClass===void 0)return null;var n=Kt(e,t,r.baseClass);return n===null?null:r.downcast(n)},Dn={},Mn=(e,t)=>{for(t===void 0&&F("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t},Ln=(e,t)=>(t=Mn(e,t),Dn[t]),An=class extends Error{constructor(t){super(t),this.name="InternalError"}},We=e=>{throw new An(e)},qe=(e,t)=>{(!t.ptrType||!t.ptr)&&We("makeClassHandle requires ptr and ptrType");var r=!!t.smartPtrType,n=!!t.smartPtr;return r!==n&&We("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Te(Object.create(e,{$$:{value:t,writable:!0}}))};function Tn(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=Ln(this.registeredClass,t);if(r!==void 0){if(r.$$.count.value===0)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function i(){return this.isSmartPointer?qe(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):qe(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o=this.registeredClass.getActualType(t),a=Yt[o];if(!a)return i.call(this);var c;this.isConst?c=a.constPointerType:c=a.pointerType;var u=Kt(t,this.registeredClass,c.registeredClass);return u===null?i.call(this):this.isSmartPointer?qe(c.registeredClass.instancePrototype,{ptrType:c,ptr:u,smartPtrType:this,smartPtr:e}):qe(c.registeredClass.instancePrototype,{ptrType:c,ptr:u})}var Pn=()=>{Object.assign(Ge.prototype,{getPointee(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},destructor(e){var t;(t=this.rawDestructor)==null||t.call(this,e)},argPackAdvance:ce,readValueFromPointer:ze,fromWireType:Tn})};function Ge(e,t,r,n,i,o,a,c,u,m,g){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=i,this.pointeeType=o,this.sharingPolicy=a,this.rawGetPointee=c,this.rawConstructor=u,this.rawShare=m,this.rawDestructor=g,!i&&t.baseClass===void 0?n?(this.toWireType=Cn,this.destructorFunction=null):(this.toWireType=$n,this.destructorFunction=null):this.toWireType=Sn}var Zt=(e,t,r)=>{p.hasOwnProperty(e)||We("Replacing nonexistent public symbol"),p[e].overloadTable!==void 0&&r!==void 0?p[e].overloadTable[r]=t:(p[e]=t,p[e].argCount=r)},Qt=[],er,k=e=>{var t=Qt[e];return t||(Qt[e]=t=er.get(e)),t},In=(e,t,r=[],n=!1)=>{var i=k(t),o=i(...r);function a(c){return e[0]=="p"?c>>>0:c}return a(o)},Bn=(e,t,r=!1)=>(...n)=>In(e,t,n,r),ge=(e,t,r=!1)=>{e=Z(e);function n(){if(e.includes("p"))return Bn(e,t,r);var o=k(t);return o}var i=n();return typeof i!="function"&&F(`unknown function pointer with signature ${e}: ${t}`),i};class xn extends Error{}var tr=e=>{var t=ur(e),r=Z(t);return ue(t),r},Ye=(e,t)=>{var r=[],n={};function i(o){if(!n[o]&&!ve[o]){if(je[o]){je[o].forEach(i);return}r.push(o),n[o]=!0}}throw t.forEach(i),new xn(`${e}: `+r.map(tr).join([", "]))},Se=(e,t,r)=>{e.forEach(c=>je[c]=t);function n(c){var u=r(c);u.length!==e.length&&We("Mismatched type converter count");for(var m=0;m<e.length;++m)ne(e[m],u[m])}var i=new Array(t.length),o=[],a=0;t.forEach((c,u)=>{ve.hasOwnProperty(c)?i[u]=ve[c]:(o.push(c),Ce.hasOwnProperty(c)||(Ce[c]=[]),Ce[c].push(()=>{i[u]=ve[c],++a,a===o.length&&n(i)}))}),o.length===0&&n(i)};function Nn(e,t,r,n,i,o,a,c,u,m,g,_,M){e>>>=0,t>>>=0,r>>>=0,n>>>=0,i>>>=0,o>>>=0,a>>>=0,c>>>=0,u>>>=0,m>>>=0,g>>>=0,_>>>=0,M>>>=0,g=Z(g),o=ge(i,o),c&&(c=ge(a,c)),m&&(m=ge(u,m)),M=ge(_,M);var D=En(g);Xt(D,function(){Ye(`Cannot construct ${g} due to unbound types`,[n])}),Se([e,t,r],n?[n]:[],A=>{var G;A=A[0];var x,V;n?(x=A.registeredClass,V=x.instancePrototype):V=Ve.prototype;var O=ft(g,function(...Ct){if(Object.getPrototypeOf(this)!==J)throw new Ae(`Use 'new' to construct ${g}`);if(W.constructor_body===void 0)throw new Ae(`${g} has no accessible constructor`);var Er=W.constructor_body[Ct.length];if(Er===void 0)throw new Ae(`Tried to invoke ctor of ${g} with invalid number of parameters (${Ct.length}) - expected (${Object.keys(W.constructor_body).toString()}) parameters instead!`);return Er.apply(this,Ct)}),J=Object.create(V,{constructor:{value:O}});O.prototype=J;var W=new kn(g,O,J,M,x,o,c,m);W.baseClass&&((G=W.baseClass).__derivedClasses??(G.__derivedClasses=[]),W.baseClass.__derivedClasses.push(W));var we=new Ge(g,W,!0,!1,!1),te=new Ge(g+"*",W,!1,!1,!1),de=new Ge(g+" const*",W,!1,!0,!1);return Yt[e]={pointerType:te,constPointerType:de},Zt(D,O),[we,te,de]})}var mt=(e,t)=>{for(var r=[],n=0;n<e;n++)r.push(B[t+n*4>>>2>>>0]);return r},rr=e=>{for(;e.length;){var t=e.pop(),r=e.pop();r(t)}};function nr(e){for(var t=1;t<e.length;++t)if(e[t]!==null&&e[t].destructorFunction===void 0)return!0;return!1}function Rn(e,t,r,n){var i=nr(e),o=e.length-2,a=[],c=["fn"];t&&c.push("thisWired");for(var u=0;u<o;++u)a.push(`arg${u}`),c.push(`arg${u}Wired`);a=a.join(","),c=c.join(",");var m=`return function (${a}) {
`;i&&(m+=`var destructors = [];
`);var g=i?"destructors":"null",_=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];t&&(m+=`var thisWired = classParam['toWireType'](${g}, this);
`);for(var u=0;u<o;++u)m+=`var arg${u}Wired = argType${u}['toWireType'](${g}, arg${u});
`,_.push(`argType${u}`);if(m+=(r||n?"var rv = ":"")+`invoker(${c});
`,i)m+=`runDestructors(destructors);
`;else for(var u=t?1:2;u<e.length;++u){var M=u===1?"thisWired":"arg"+(u-2)+"Wired";e[u].destructorFunction!==null&&(m+=`${M}_dtor(${M});
`,_.push(`${M}_dtor`))}return r&&(m+=`var ret = retType['fromWireType'](rv);
return ret;
`),m+=`}
`,[_,m]}function vt(e,t,r,n,i,o){var a=t.length;a<2&&F("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var c=t[1]!==null&&r!==null,u=nr(t),m=t[0].name!=="void",g=[e,F,n,i,rr,t[0],t[1]],_=0;_<a-2;++_)g.push(t[_+2]);if(!u)for(var _=c?1:2;_<t.length;++_)t[_].destructorFunction!==null&&g.push(t[_].destructorFunction);let[M,D]=Rn(t,c,m,o);var A=new Function(...M,D)(...g);return ft(e,A)}var Fn=function(e,t,r,n,i,o){e>>>=0,r>>>=0,n>>>=0,i>>>=0,o>>>=0;var a=mt(t,r);i=ge(n,i),Se([],[e],c=>{c=c[0];var u=`constructor ${c.name}`;if(c.registeredClass.constructor_body===void 0&&(c.registeredClass.constructor_body=[]),c.registeredClass.constructor_body[t-1]!==void 0)throw new Ae(`Cannot register multiple constructors with identical number of parameters (${t-1}) for class '${c.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return c.registeredClass.constructor_body[t-1]=()=>{Ye(`Cannot construct ${c.name} due to unbound types`,a)},Se([],a,m=>(m.splice(1,0,null),c.registeredClass.constructor_body[t-1]=vt(u,m,null,i,o),[])),[]})},ir=e=>{e=e.trim();const t=e.indexOf("(");return t===-1?e:e.slice(0,t)},Hn=function(e,t,r,n,i,o,a,c,u,m){e>>>=0,t>>>=0,n>>>=0,i>>>=0,o>>>=0,a>>>=0;var g=mt(r,n);t=Z(t),t=ir(t),o=ge(i,o,u),Se([],[e],_=>{_=_[0];var M=`${_.name}.${t}`;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),c&&_.registeredClass.pureVirtualFunctions.push(t);function D(){Ye(`Cannot call ${M} due to unbound types`,g)}var A=_.registeredClass.instancePrototype,x=A[t];return x===void 0||x.overloadTable===void 0&&x.className!==_.name&&x.argCount===r-2?(D.argCount=r-2,D.className=_.name,A[t]=D):(Jt(A,t,M),A[t].overloadTable[r-2]=D),Se([],g,V=>{var O=vt(M,V,_,o,a,u);return A[t].overloadTable===void 0?(O.argCount=r-2,A[t]=O):A[t].overloadTable[r-2]=O,[]}),[]})},or=[],ye=[0,1,,1,null,1,!0,1,!1,1];function gt(e){e>>>=0,e>9&&--ye[e+1]===0&&(ye[e]=void 0,or.push(e))}var q={toValue:e=>(e||F(`Cannot use deleted val. handle = ${e}`),ye[e]),toHandle:e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const t=or.pop()||ye.length;return ye[t]=e,ye[t+1]=1,t}}}},sr={name:"emscripten::val",fromWireType:e=>{var t=q.toValue(e);return gt(e),t},toWireType:(e,t)=>q.toHandle(t),argPackAdvance:ce,readValueFromPointer:ze,destructorFunction:null};function Un(e){return e>>>=0,ne(e,sr)}var On=(e,t)=>{switch(t){case 4:return function(r){return this.fromWireType(Lt[r>>>2>>>0])};case 8:return function(r){return this.fromWireType(At[r>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}},jn=function(e,t,r){e>>>=0,t>>>=0,r>>>=0,t=Z(t),ne(e,{name:t,fromWireType:n=>n,toWireType:(n,i)=>i,argPackAdvance:ce,readValueFromPointer:On(t,r),destructorFunction:null})};function Vn(e,t,r,n,i,o,a,c){e>>>=0,r>>>=0,n>>>=0,i>>>=0,o>>>=0;var u=mt(t,r);e=Z(e),e=ir(e),i=ge(n,i,a),Xt(e,function(){Ye(`Cannot call ${e} due to unbound types`,u)},t-1),Se([],u,m=>{var g=[m[0],null].concat(m.slice(1));return Zt(e,vt(e,g,null,i,o,a),t-1),[]})}var zn=function(e,t,r,n,i){e>>>=0,t>>>=0,r>>>=0,t=Z(t);const o=n===0;let a=u=>u;if(o){var c=32-8*r;a=u=>u<<c>>>c,i=a(i)}ne(e,{name:t,fromWireType:a,toWireType:(u,m)=>m,argPackAdvance:ce,readValueFromPointer:Wt(t,r,n!==0),destructorFunction:null})};function Wn(e,t,r){e>>>=0,r>>>=0;var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array],i=n[t];function o(a){var c=B[a>>>2>>>0],u=B[a+4>>>2>>>0];return new i(ee.buffer,u,c)}r=Z(r),ne(e,{name:r,fromWireType:o,argPackAdvance:ce,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})}var qn=Object.assign({optional:!0},sr);function Gn(e,t){e>>>=0,ne(e,qn)}var $e=(e,t,r)=>Ut(e,re,t,r);function Yn(e,t){e>>>=0,t>>>=0,t=Z(t),ne(e,{name:t,fromWireType(r){for(var n=B[r>>>2>>>0],i=r+4,o,a,c=i,a=0;a<=n;++a){var u=i+a;if(a==n||re[u>>>0]==0){var m=u-c,g=zt(c,m);o===void 0?o=g:(o+="\0",o+=g),c=u+1}}return ue(r),o},toWireType(r,n){n instanceof ArrayBuffer&&(n=new Uint8Array(n));var i,o=typeof n=="string";o||ArrayBuffer.isView(n)&&n.BYTES_PER_ELEMENT==1||F("Cannot pass non-string to std::string"),o?i=at(n):i=n.length;var a=bt(4+i+1),c=a+4;return B[a>>>2>>>0]=i,o?$e(n,c,i+1):re.set(n,c>>>0),r!==null&&r.push(ue,a),a},argPackAdvance:ce,readValueFromPointer:ze,destructorFunction(r){ue(r)}})}var ar=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Jn=(e,t)=>{for(var r=e>>>1,n=r+t/2,i=r;!(i>=n)&&be[i>>>0];)++i;if(i-r>16&&ar)return ar.decode(be.subarray(r>>>0,i>>>0));for(var o="",a=r;!(a>=n);++a){var c=be[a>>>0];if(c==0)break;o+=String.fromCharCode(c)}return o},Xn=(e,t,r)=>{if(r??(r=2147483647),r<2)return 0;r-=2;for(var n=t,i=r<e.length*2?r/2:e.length,o=0;o<i;++o){var a=e.charCodeAt(o);De[t>>>1>>>0]=a,t+=2}return De[t>>>1>>>0]=0,t-n},Kn=e=>e.length*2,Zn=(e,t)=>{for(var r="",n=0;!(n>=t/4);n++){var i=N[e+n*4>>>2>>>0];if(!i)break;r+=String.fromCodePoint(i)}return r},Qn=(e,t,r)=>{if(t>>>=0,r??(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,o=0;o<e.length;++o){var a=e.codePointAt(o);if(a>65535&&o++,N[t>>>2>>>0]=a,t+=4,t+4>i)break}return N[t>>>2>>>0]=0,t-n},ei=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.codePointAt(r);n>65535&&r++,t+=4}return t},ti=function(e,t,r){e>>>=0,t>>>=0,r>>>=0,r=Z(r);var n,i,o,a;t===2?(n=Jn,i=Xn,a=Kn,o=c=>be[c>>>1>>>0]):t===4&&(n=Zn,i=Qn,a=ei,o=c=>B[c>>>2>>>0]),ne(e,{name:r,fromWireType:c=>{for(var u=B[c>>>2>>>0],m,g=c+4,_=0;_<=u;++_){var M=c+4+_*t;if(_==u||o(M)==0){var D=M-g,A=n(g,D);m===void 0?m=A:(m+="\0",m+=A),g=M+t}}return ue(c),m},toWireType:(c,u)=>{typeof u!="string"&&F(`Cannot pass non-string to C++ string type ${r}`);var m=a(u),g=bt(4+m+t);return B[g>>>2>>>0]=m/t,i(u,g+4,m+t),c!==null&&c.push(ue,g),g},argPackAdvance:ce,readValueFromPointer:ze,destructorFunction(c){ue(c)}})},ri=function(e,t){e>>>=0,t>>>=0,t=Z(t),ne(e,{isVoid:!0,name:t,argPackAdvance:0,fromWireType:()=>{},toWireType:(r,n)=>{}})},ni=()=>{throw 1/0},yt=(e,t)=>{var r=ve[e];return r===void 0&&F(`${t} has unknown type ${tr(e)}`),r},lr=(e,t,r)=>{var n=[],i=e.toWireType(n,r);return n.length&&(B[t>>>2>>>0]=q.toHandle(n)),i};function ii(e,t,r){return e>>>=0,t>>>=0,r>>>=0,e=q.toValue(e),t=yt(t,"emval::as"),lr(t,r,e)}var Je=[];function oi(e,t,r,n){return e>>>=0,t>>>=0,r>>>=0,n>>>=0,e=Je[e],t=q.toValue(t),e(null,t,r,n)}var si={},wt=e=>{var t=si[e];return t===void 0?Z(e):t};function ai(e,t,r,n,i){return e>>>=0,t>>>=0,r>>>=0,n>>>=0,i>>>=0,e=Je[e],t=q.toValue(t),r=wt(r),e(t,t[r],n,i)}var cr=()=>globalThis;function li(e){return e>>>=0,e===0?q.toHandle(cr()):(e=wt(e),q.toHandle(cr()[e]))}var ci=e=>{var t=Je.length;return Je.push(e),t},di=(e,t)=>{for(var r=new Array(e),n=0;n<e;++n)r[n]=yt(B[t+n*4>>>2>>>0],`parameter ${n}`);return r};function ui(e,t,r){t>>>=0;var n=di(e,t),i=n.shift();e--;var o=`return function (obj, func, destructorsRef, args) {
`,a=0,c=[];r===0&&c.push("obj");for(var u=["retType"],m=[i],g=0;g<e;++g)c.push(`arg${g}`),u.push(`argType${g}`),m.push(n[g]),o+=`  var arg${g} = argType${g}.readValueFromPointer(args${a?"+"+a:""});
`,a+=n[g].argPackAdvance;var _=r===1?"new func":"func.call";o+=`  var rv = ${_}(${c.join(", ")});
`,i.isVoid||(u.push("emval_returnValue"),m.push(lr),o+=`  return emval_returnValue(retType, destructorsRef, rv);
`),o+=`};
`;var M=new Function(...u,o)(...m),D=`methodCaller<(${n.map(A=>A.name).join(", ")}) => ${i.name}>`;return ci(ft(D,M))}function fi(e,t){return e>>>=0,t>>>=0,e=q.toValue(e),t=q.toValue(t),q.toHandle(e[t])}function hi(e){e>>>=0,e>9&&(ye[e+1]+=1)}function pi(e){return e>>>=0,q.toHandle(wt(e))}function mi(){return q.toHandle({})}function vi(e){e>>>=0;var t=q.toValue(e);rr(t),gt(e)}function gi(e,t,r){e>>>=0,t>>>=0,r>>>=0,e=q.toValue(e),t=q.toValue(t),r=q.toValue(r),e[t]=r}function yi(e,t){e>>>=0,t>>>=0,e=yt(e,"_emval_take_value");var r=e.readValueFromPointer(t);return q.toHandle(r)}function wi(e){return e>>>=0,e=q.toValue(e),q.toHandle(typeof e)}var _i=e=>e%4===0&&(e%100!==0||e%400===0),bi=[0,31,60,91,121,152,182,213,244,274,305,335],Ei=[0,31,59,90,120,151,181,212,243,273,304,334],ki=e=>{var t=_i(e.getFullYear()),r=t?bi:Ei,n=r[e.getMonth()]+e.getDate()-1;return n};function Ci(e,t){e=He(e),t>>>=0;var r=new Date(e*1e3);N[t>>>2>>>0]=r.getSeconds(),N[t+4>>>2>>>0]=r.getMinutes(),N[t+8>>>2>>>0]=r.getHours(),N[t+12>>>2>>>0]=r.getDate(),N[t+16>>>2>>>0]=r.getMonth(),N[t+20>>>2>>>0]=r.getFullYear()-1900,N[t+24>>>2>>>0]=r.getDay();var n=ki(r)|0;N[t+28>>>2>>>0]=n,N[t+36>>>2>>>0]=-(r.getTimezoneOffset()*60);var i=new Date(r.getFullYear(),0,1),o=new Date(r.getFullYear(),6,1).getTimezoneOffset(),a=i.getTimezoneOffset(),c=(o!=a&&r.getTimezoneOffset()==Math.min(a,o))|0;N[t+32>>>2>>>0]=c}function Si(e,t,r,n,i,o,a){e>>>=0,i=He(i),o>>>=0,a>>>=0;try{var c=Y.getStreamFromFD(n),u=l.mmap(c,e,i,t,r),m=u.ptr;return N[o>>>2>>>0]=u.allocated,B[a>>>2>>>0]=m,0}catch(g){if(typeof l>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function $i(e,t,r,n,i,o){e>>>=0,t>>>=0,o=He(o);try{var a=Y.getStreamFromFD(i);r&2&&Y.doMsync(e,a,t,n,o)}catch(c){if(typeof l>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var Di=function(e,t,r,n){e>>>=0,t>>>=0,r>>>=0,n>>>=0;var i=new Date().getFullYear(),o=new Date(i,0,1),a=new Date(i,6,1),c=o.getTimezoneOffset(),u=a.getTimezoneOffset(),m=Math.max(c,u);B[e>>>2>>>0]=m*60,N[t>>>2>>>0]=+(c!=u);var g=D=>{var A=D>=0?"-":"+",x=Math.abs(D),V=String(Math.floor(x/60)).padStart(2,"0"),O=String(x%60).padStart(2,"0");return`UTC${A}${V}${O}`},_=g(c),M=g(u);u<c?($e(_,r,17),$e(M,n,17)):($e(_,n,17),$e(M,r,17))},Mi=()=>performance.now(),dr=()=>Date.now(),Li=e=>e>=0&&e<=3;function Ai(e,t,r){if(r>>>=0,!Li(e))return 28;var n;e===0?n=dr():n=Mi();var i=Math.round(n*1e3*1e3);return ae[r>>>3>>>0]=BigInt(i),0}var Ti=()=>4294901760,Pi=e=>{var t=Ne.buffer,r=(e-t.byteLength+65535)/65536|0;try{return Ne.grow(r),It(),1}catch{}};function Ii(e){e>>>=0;var t=re.length,r=Ti();if(e>r)return!1;for(var n=1;n<=4;n*=2){var i=t*(1+.2/n);i=Math.min(i,e+100663296);var o=Math.min(r,Ot(Math.max(e,i),65536)),a=Pi(o);if(a)return!0}return!1}var _t={},Bi=()=>L||"./this.program",Pe=()=>{if(!Pe.strings){var e=(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Bi()};for(var r in _t)_t[r]===void 0?delete t[r]:t[r]=_t[r];var n=[];for(var r in t)n.push(`${r}=${t[r]}`);Pe.strings=n}return Pe.strings};function xi(e,t){e>>>=0,t>>>=0;var r=0,n=0;for(var i of Pe()){var o=t+r;B[e+n>>>2>>>0]=o,r+=$e(i,o,1/0)+1,n+=4}return 0}function Ni(e,t){e>>>=0,t>>>=0;var r=Pe();B[e>>>2>>>0]=r.length;var n=0;for(var i of r)n+=at(i)+1;return B[t>>>2>>>0]=n,0}function Ri(e){try{var t=Y.getStreamFromFD(e);return l.close(t),0}catch(r){if(typeof l>"u"||r.name!=="ErrnoError")throw r;return r.errno}}var Fi=(e,t,r,n)=>{for(var i=0,o=0;o<r;o++){var a=B[t>>>2>>>0],c=B[t+4>>>2>>>0];t+=8;var u=l.read(e,ee,a,c,n);if(u<0)return-1;if(i+=u,u<c)break}return i};function Hi(e,t,r,n){t>>>=0,r>>>=0,n>>>=0;try{var i=Y.getStreamFromFD(e),o=Fi(i,t,r);return B[n>>>2>>>0]=o,0}catch(a){if(typeof l>"u"||a.name!=="ErrnoError")throw a;return a.errno}}function Ui(e,t,r,n){t=He(t),n>>>=0;try{if(isNaN(t))return 61;var i=Y.getStreamFromFD(e);return l.llseek(i,t,r),ae[n>>>3>>>0]=BigInt(i.position),i.getdents&&t===0&&r===0&&(i.getdents=null),0}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return o.errno}}var Oi=(e,t,r,n)=>{for(var i=0,o=0;o<r;o++){var a=B[t>>>2>>>0],c=B[t+4>>>2>>>0];t+=8;var u=l.write(e,ee,a,c,n);if(u<0)return-1;if(i+=u,u<c)break}return i};function ji(e,t,r,n){t>>>=0,r>>>=0,n>>>=0;try{var i=Y.getStreamFromFD(e),o=Oi(i,t,r);return B[n>>>2>>>0]=o,0}catch(a){if(typeof l>"u"||a.name!=="ErrnoError")throw a;return a.errno}}function Vi(e){return e>>>=0,e}l.createPreloadedFile=an,l.staticInit(),I.doesNotExistError=new l.ErrnoError(44),I.doesNotExistError.stack="<generic error, no stack>",wn(),Pn(),p.noExitRuntime&&p.noExitRuntime,p.preloadPlugins&&(Vt=p.preloadPlugins),p.print&&(Q=p.print),p.printErr&&(X=p.printErr),p.wasmBinary&&(ie=p.wasmBinary),p.arguments&&p.arguments,p.thisProgram&&(L=p.thisProgram);var ur,bt,ue,fr,Et,C,hr,pr,mr,vr,gr,yr,wr,_r;function zi(e){ur=e.$b,bt=e.bc,ue=e.cc,fr=e.dc,Et=e.ec,C=e.fc,hr=e.gc,pr=e.hc,mr=e.ic,vr=e.jc,gr=e.kc,yr=e.lc,wr=e.mc,_r=e.nc}var Wi={n:zr,y:Wr,a:qr,j:Gr,D:Yr,Ga:Jr,p:Xr,Oa:Kr,f:Zr,Hb:cn,Fb:dn,Eb:un,Gb:fn,tb:hn,Ia:mn,kb:vn,_:Nn,oa:Fn,s:Hn,ib:Un,Ha:jn,L:Vn,T:zn,K:Wn,Wa:Gn,jb:Yn,wa:ti,lb:ri,vb:ni,Ma:ii,mb:oi,X:ai,rb:gt,nb:li,Y:ui,sb:fi,Ka:hi,ya:pi,pb:mi,qb:vi,ob:gi,xa:yi,Ja:wi,zb:Ci,xb:Si,yb:$i,Ab:Di,Jb:Ai,Ib:dr,wb:Ii,Cb:xi,Db:Ni,Ra:Ri,Pa:Hi,Bb:Ui,Qa:ji,w:yo,x:Co,Za:us,B:Qi,pa:ao,C:os,Lb:Ns,Sa:xs,_a:as,Kb:Rs,Xb:ls,V:wo,Ta:Ts,ka:xo,Na:Us,Qb:$s,Nb:Is,v:io,b:Yi,I:bo,ab:rs,$a:is,ta:Io,eb:Bo,ja:Fo,fa:Eo,c:qi,G:Vo,aa:ts,Da:Go,ca:Wo,ba:qo,bb:Zo,R:zo,d:so,O:jo,k:co,ub:Fs,N:Uo,q:no,cb:Ko,m:lo,db:Xo,A:eo,Q:fs,E:mo,S:vo,ma:po,va:ho,Fa:So,Tb:bs,Xa:ws,Ya:vs,ua:_o,Rb:Cs,qa:Hs,Sb:Es,g:Gi,l:Zi,da:No,hb:$o,la:Do,na:ns,ra:cs,Ca:Yo,sa:Jo,Aa:Ds,Pb:As,P:Ms,Ob:Ps,h:Xi,r:ko,W:go,ia:Ho,Ua:Ss,Mb:Bs,e:Ji,F:ds,Ba:Qo,ea:Ao,fb:To,i:Ki,Yb:ss,Vb:ys,Ea:Po,gb:Lo,za:Ls,o:oo,U:Oo,ha:es,u:uo,z:ro,J:fo,H:Mo,M:Ro,ga:ps,Wb:hs,La:to,$:gs,Z:ms,Ub:_s,Va:ks,t:Vi},fe=await Hr();function qi(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function Gi(e){var t=$();try{k(e)()}catch(r){if(S(t),r!==r+0)throw r;C(1,0)}}function Yi(e,t){var r=$();try{return k(e)(t)}catch(n){if(S(r),n!==n+0)throw n;C(1,0)}}function Ji(e,t,r,n){var i=$();try{k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function Xi(e,t,r){var n=$();try{k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function Ki(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Zi(e,t){var r=$();try{k(e)(t)}catch(n){if(S(r),n!==n+0)throw n;C(1,0)}}function Qi(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function eo(e,t,r,n,i,o,a,c){var u=$();try{return k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function to(e,t,r,n,i,o,a,c,u,m,g,_,M,D,A){var x=$();try{k(e)(t,r,n,i,o,a,c,u,m,g,_,M,D,A)}catch(V){if(S(x),V!==V+0)throw V;C(1,0)}}function ro(e,t,r,n,i,o,a,c){var u=$();try{k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function no(e,t,r,n,i,o){var a=$();try{return k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function io(e){var t=$();try{return k(e)()}catch(r){if(S(t),r!==r+0)throw r;C(1,0)}}function oo(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function so(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function ao(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function lo(e,t,r,n,i,o,a){var c=$();try{return k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function co(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function uo(e,t,r,n,i,o,a){var c=$();try{k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function fo(e,t,r,n,i,o,a,c,u){var m=$();try{k(e)(t,r,n,i,o,a,c,u)}catch(g){if(S(m),g!==g+0)throw g;C(1,0)}}function ho(e,t,r,n,i,o,a,c,u,m,g,_,M){var D=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g,_,M)}catch(A){if(S(D),A!==A+0)throw A;C(1,0)}}function po(e,t,r,n,i,o,a,c,u,m,g,_){var M=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g,_)}catch(D){if(S(M),D!==D+0)throw D;C(1,0)}}function mo(e,t,r,n,i,o,a,c,u,m){var g=$();try{return k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function vo(e,t,r,n,i,o,a,c,u,m,g){var _=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g)}catch(M){if(S(_),M!==M+0)throw M;C(1,0)}}function go(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function yo(e,t){var r=$();try{return k(e)(t)}catch(n){if(S(r),n!==n+0)throw n;C(1,0)}}function wo(e,t){var r=$();try{return k(e)(t)}catch(n){if(S(r),n!==n+0)throw n;C(1,0)}}function _o(e,t){var r=$();try{return k(e)(t)}catch(n){if(S(r),n!==n+0)throw n;return C(1,0),0n}}function bo(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function Eo(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function ko(e,t,r,n){var i=$();try{k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function Co(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function So(e,t,r,n,i,o,a,c,u,m,g,_,M,D,A,x,V){var O=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g,_,M,D,A,x,V)}catch(J){if(S(O),J!==J+0)throw J;C(1,0)}}function $o(e,t,r,n){var i=$();try{k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function Do(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Mo(e,t,r,n,i,o,a,c,u,m){var g=$();try{k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function Lo(e,t,r,n,i,o,a,c,u){var m=$();try{k(e)(t,r,n,i,o,a,c,u)}catch(g){if(S(m),g!==g+0)throw g;C(1,0)}}function Ao(e,t,r,n,i,o,a,c,u,m){var g=$();try{k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function To(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function Po(e,t,r,n,i,o,a,c){var u=$();try{k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function Io(e,t,r,n,i,o){var a=$();try{return k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function Bo(e,t,r,n,i,o,a){var c=$();try{return k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function xo(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function No(e,t,r){var n=$();try{k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function Ro(e,t,r,n,i,o,a,c,u,m,g){var _=$();try{k(e)(t,r,n,i,o,a,c,u,m,g)}catch(M){if(S(_),M!==M+0)throw M;C(1,0)}}function Fo(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function Ho(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function Uo(e,t,r,n,i,o,a,c,u){var m=$();try{return k(e)(t,r,n,i,o,a,c,u)}catch(g){if(S(m),g!==g+0)throw g;C(1,0)}}function Oo(e,t,r,n,i,o,a){var c=$();try{k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function jo(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Vo(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function zo(e,t,r,n,i,o,a,c,u,m,g){var _=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g)}catch(M){if(S(_),M!==M+0)throw M;C(1,0)}}function Wo(e,t,r,n,i,o,a,c){var u=$();try{return k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function qo(e,t,r,n,i,o,a,c,u,m){var g=$();try{return k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function Go(e,t,r,n,i,o,a,c,u,m,g){var _=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g)}catch(M){if(S(_),M!==M+0)throw M;C(1,0)}}function Yo(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Jo(e,t,r,n,i,o,a,c){var u=$();try{k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function Xo(e,t,r,n,i,o,a,c,u,m,g){var _=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g)}catch(M){if(S(_),M!==M+0)throw M;C(1,0)}}function Ko(e,t,r,n,i,o,a,c,u,m){var g=$();try{return k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function Zo(e,t,r,n,i,o,a,c,u,m,g,_){var M=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g,_)}catch(D){if(S(M),D!==D+0)throw D;C(1,0)}}function Qo(e,t,r,n,i,o,a){var c=$();try{k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function es(e,t,r,n,i,o,a,c){var u=$();try{k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function ts(e,t,r,n,i,o,a,c,u,m){var g=$();try{return k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function rs(e,t,r,n,i,o,a,c,u){var m=$();try{return k(e)(t,r,n,i,o,a,c,u)}catch(g){if(S(m),g!==g+0)throw g;C(1,0)}}function ns(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function is(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function os(e,t,r,n,i,o){var a=$();try{return k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function ss(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function as(e,t,r,n,i,o,a,c,u,m){var g=$();try{return k(e)(t,r,n,i,o,a,c,u,m)}catch(_){if(S(g),_!==_+0)throw _;C(1,0)}}function ls(e,t,r,n,i,o,a,c,u,m,g,_,M,D){var A=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g,_,M,D)}catch(x){if(S(A),x!==x+0)throw x;C(1,0)}}function cs(e,t,r,n){var i=$();try{k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function ds(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function us(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function fs(e,t,r,n,i,o,a,c,u){var m=$();try{return k(e)(t,r,n,i,o,a,c,u)}catch(g){if(S(m),g!==g+0)throw g;C(1,0)}}function hs(e,t,r,n,i,o,a,c,u,m,g,_,M){var D=$();try{k(e)(t,r,n,i,o,a,c,u,m,g,_,M)}catch(A){if(S(D),A!==A+0)throw A;C(1,0)}}function ps(e,t,r,n,i,o,a,c,u,m,g,_){var M=$();try{k(e)(t,r,n,i,o,a,c,u,m,g,_)}catch(D){if(S(M),D!==D+0)throw D;C(1,0)}}function ms(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function vs(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function gs(e,t,r,n,i,o,a,c,u,m,g,_,M,D,A,x){var V=$();try{k(e)(t,r,n,i,o,a,c,u,m,g,_,M,D,A,x)}catch(O){if(S(V),O!==O+0)throw O;C(1,0)}}function ys(e,t,r,n,i,o,a){var c=$();try{k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function ws(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function _s(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function bs(e,t,r,n,i,o,a,c){var u=$();try{return k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function Es(e,t,r,n,i,o,a,c){var u=$();try{return k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;return C(1,0),0n}}function ks(e,t,r,n){var i=$();try{k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function Cs(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;return C(1,0),0n}}function Ss(e,t,r,n){var i=$();try{k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function $s(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Ds(e,t,r){var n=$();try{k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function Ms(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Ls(e,t,r,n,i,o,a,c,u,m,g,_){var M=$();try{k(e)(t,r,n,i,o,a,c,u,m,g,_)}catch(D){if(S(M),D!==D+0)throw D;C(1,0)}}function As(e,t,r,n,i,o,a,c){var u=$();try{k(e)(t,r,n,i,o,a,c)}catch(m){if(S(u),m!==m+0)throw m;C(1,0)}}function Ts(e,t,r){var n=$();try{return k(e)(t,r)}catch(i){if(S(n),i!==i+0)throw i;C(1,0)}}function Ps(e,t,r,n,i){var o=$();try{k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;C(1,0)}}function Is(e,t,r,n,i,o,a){var c=$();try{return k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function Bs(e,t,r,n,i,o){var a=$();try{k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function xs(e,t,r,n,i,o,a,c,u){var m=$();try{return k(e)(t,r,n,i,o,a,c,u)}catch(g){if(S(m),g!==g+0)throw g;C(1,0)}}function Ns(e,t,r,n,i,o,a){var c=$();try{return k(e)(t,r,n,i,o,a)}catch(u){if(S(c),u!==u+0)throw u;C(1,0)}}function Rs(e,t,r,n,i,o,a,c,u,m,g){var _=$();try{return k(e)(t,r,n,i,o,a,c,u,m,g)}catch(M){if(S(_),M!==M+0)throw M;C(1,0)}}function Fs(e,t,r,n,i,o){var a=$();try{return k(e)(t,r,n,i,o)}catch(c){if(S(a),c!==c+0)throw c;C(1,0)}}function Hs(e,t,r,n,i){var o=$();try{return k(e)(t,r,n,i)}catch(a){if(S(o),a!==a+0)throw a;return C(1,0),0n}}function Us(e,t,r,n){var i=$();try{return k(e)(t,r,n)}catch(o){if(S(i),o!==o+0)throw o;C(1,0)}}function Os(e){e=Object.assign({},e);var t=i=>o=>i(o)>>>0,r=i=>(o,a)=>i(o,a)>>>0,n=i=>()=>i()>>>0;return e.$b=t(e.$b),e.bc=t(e.bc),e.dc=r(e.dc),e.ec=n(e.ec),e.emscripten_stack_get_base=n(e.emscripten_stack_get_base),e._emscripten_stack_alloc=t(e._emscripten_stack_alloc),e.jc=n(e.jc),e.nc=t(e.nc),e}function js(){pr(),Lr()}function kt(){if(pe>0){Me=kt;return}if(js(),Ar(),pe>0){Me=kt;return}function e(){var t;p.calledRun=!0,!se&&(Tr(),Be==null||Be(p),(t=p.onRuntimeInitialized)==null||t.call(p),Pr())}p.setStatus?(p.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>p.setStatus(""),1),e()},1)):e(),et()}function Vs(){if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);p.preInit.length>0;)p.preInit.shift()()}return Vs(),kt(),Pt?y=p:y=new Promise((e,t)=>{Be=e,xe=t}),y}})();P.exports=d,P.exports.default=d})(Dr);var La=Dr.exports;const Aa=Sa(La);let $t=null;async function Ta(){return $t||($t=await Aa()),$t}async function Pa(){const P=await Ta(),s=document.createElement("button");s.id="joy-btn",s.textContent="Joy",Object.assign(s.style,{position:"fixed",bottom:"20px",left:"20px",zIndex:1002}),s.addEventListener("click",()=>{const d=P.get_mol("c1ccccc1");alert(d.get_smiles()),d.delete()}),document.body.appendChild(s)}class Ia{constructor(){this.repository=new da(aa.map(s=>({code:s,status:"pending"}))),this.grid=null,this.loadingIndicator=null,this.cardUI=null,this.loader=null,this.ligandModal=null,this.boundLigandTable=null,this.pdbDetailsModal=null,this.addModal=null,this.comparisonModal=null,this.compareQueue=[]}init(){this.grid=document.getElementById("molecule-grid"),this.loadingIndicator=document.querySelector(".loading-indicator"),this.cardUI=new wa(this.grid,this.repository,{onDelete:p=>this.confirmDelete(p),onShowDetails:(p,w,E)=>this.showMoleculeDetails(p,w,E),onCompare:p=>this.queueComparison(p)}),this.loader=new ca(this.repository,this.cardUI),this.ligandModal=new ya(this),this.boundLigandTable=new ua(p=>this.addMolecule(p),p=>this.showMoleculeDetails(p),this.ligandModal),this.pdbDetailsModal=new _a(this.boundLigandTable),this.addModal=new Ea(this),this.comparisonModal=new Ca,document.getElementById("add-molecule-btn").addEventListener("click",()=>{this.addModal&&this.addModal.open()}),document.getElementById("delete-all-btn").addEventListener("click",()=>{confirm("Delete all molecules?")&&this.deleteAllMolecules()});const s=document.getElementById("export-modal"),d=document.getElementById("export-filename"),h=document.getElementById("export-remove-h-toggle"),f=()=>s.style.display="none";document.getElementById("export-btn").addEventListener("click",()=>{s&&(d.value="molecules",h.checked=!1,s.style.display="block")}),document.getElementById("cancel-export-btn").addEventListener("click",f),document.getElementById("close-export-modal").addEventListener("click",f),document.getElementById("confirm-export-btn").addEventListener("click",()=>{const p=this.repository.exportToSdf({removeHydrogens:h.checked});if(!p){he("No SDF data to export","info");return}let w=d.value.trim()||"molecules";w.toLowerCase().endsWith(".sdf")||(w+=".sdf");const E=new Blob([p],{type:"chemical/x-mdl-sdfile"}),b=URL.createObjectURL(E),L=document.createElement("a");L.href=b,L.download=w,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(b),f()});const v=document.querySelectorAll(".tab-button"),y=[document.getElementById("molecule-library-content"),document.getElementById("fragment-library-content"),document.getElementById("protein-browser-content")];return v.forEach((p,w)=>{p.addEventListener("click",()=>{v.forEach((E,b)=>E.classList.toggle("active",b===w)),y.forEach((E,b)=>{E.style.display=b===w?"block":"none"})})}),this}addMolecule(s){const d=this.repository.addMolecule(s);return d&&this.loader.loadMolecule(s),d}addPdbInstance({code:s,pdbId:d,authSeqId:h,labelAsymId:f}){return this.addMolecule({code:s,pdbId:d,authSeqId:h,labelAsymId:f})}deleteMolecule(s){if(this.repository.removeMolecule(s)){const d=this.grid.querySelector(`[data-molecule-code="${s}"]`);return d&&d.remove(),!0}return!1}deleteAllMolecules(){this.repository.clearAll(),this.cardUI&&this.cardUI.clearAll(),he("All molecules deleted successfully!","info")}getMolecule(s){return this.repository.getMolecule(s)}getAllMolecules(){return this.repository.getAllMolecules()}updateMoleculeStatus(s,d){this.repository.updateMoleculeStatus(s,d)}queueComparison(s){if(!this.compareQueue.includes(s))if(this.compareQueue.push(s),this.compareQueue.length===2){const[d,h]=this.compareQueue,f=this.getMolecule(d),v=this.getMolecule(h);f&&v&&this.comparisonModal&&(f.sdf&&v.sdf?this.comparisonModal.show(f,v):typeof he=="function"&&he("Both molecules must be loaded before comparison","error")),this.compareQueue=[]}else typeof he=="function"&&he("Select another molecule to compare","info")}loadAllMolecules(){this.loadingIndicator&&(this.loadingIndicator.style.display="block"),this.loader.loadAllMolecules().finally(()=>{this.loadingIndicator&&(this.loadingIndicator.style.display="none")})}showMoleculeDetails(s,d,h){this.ligandModal&&this.ligandModal.show(s,d,h)}fetchRCSBDetails(s){return this.pdbDetailsModal?this.pdbDetailsModal.fetchRCSBDetails(s):Promise.resolve(null)}showPDBDetailsModal(s){this.pdbDetailsModal&&this.pdbDetailsModal.showPDBDetailsModal(s)}confirmDelete(s){confirm(`Delete ${s}?`)&&this.deleteMolecule(s)}}const Qe=new Ia().init();Qe.loadAllMolecules();const Mr=new fa(Qe,{notify:he,smilesDrawer:window.SmilesDrawer}).init();Mr.loadFragments();const Ba=new ka(Qe).init();function he(P,s="info"){const d=document.createElement("div");d.className=`notification ${s}`,d.textContent=P,Object.assign(d.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 20px",borderRadius:"6px",color:"white",fontWeight:"500",zIndex:"1001",opacity:"0",transform:"translateY(-20px)",transition:"all 0.3s ease"}),s==="success"?d.style.background="#4CAF50":s==="error"?d.style.background="#f44336":d.style.background="#6e45e2",document.body.appendChild(d),setTimeout(()=>{d.style.opacity="1",d.style.transform="translateY(0)"},10),setTimeout(()=>{d.style.opacity="0",d.style.transform="translateY(-20px)",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},300)},3e3)}Pa();window.moleculeManager=Qe;window.fragmentLibrary=Mr;window.proteinBrowser=Ba;window.showNotification=he;
